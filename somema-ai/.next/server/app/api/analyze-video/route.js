(()=>{var e={};e.id=1988,e.ids=[1988],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10523:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>T,routeModule:()=>P,serverHooks:()=>A,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>z});var i={};r.r(i),r.d(i,{POST:()=>S,config:()=>k,runtime:()=>v});var s=r(96559),n=r(48088),o=r(37719),a=r(32190),l=r(29021),c=r.n(l),h=r(33873),f=r.n(h);let u=require("child_process");var d=r(21820),p=r.n(d),_=r(34728),m=r.n(_),y=r(27910),b=r(66437),g=r(49485);let v="nodejs",k={api:{bodyParser:!1}};async function w(e){return new Promise((t,r)=>{let i={},s=e.headers;if(s&&"function"==typeof s.get)for(let[e,t]of s.entries())i[e.toLowerCase()]=t;else if(s&&"object"==typeof s)for(let e in s)i[e.toLowerCase()]=s[e];if(console.log("[analyze-video] Normalized headers:",i),!i["content-type"])return r(Error("Missing Content-Type header for multipart form data."));let n=m()({headers:i}),o="",a=null;n.on("file",(e,t,r)=>{let i="string"==typeof r&&r?r:`upload-${Date.now()}.mp4`,s=p().tmpdir();o=f().join(s,`${Date.now()}-${i}`);let n=c().createWriteStream(o);a=new Promise((e,r)=>{t.pipe(n),n.on("finish",e),n.on("error",r)})}),n.on("finish",async()=>{try{if(a&&await a,!o)return r(Error("No file uploaded"));t({videoPath:o})}catch(e){r(e)}}),n.on("error",r),(function(e){let t=e.getReader();return new y.Readable({async read(){let{done:e,value:r}=await t.read();e?this.push(null):this.push(Buffer.from(r))}})})(e.body).pipe(n)})}async function C(e,t){let r=`data:image/png;base64,${e}`,i=await fetch(`${process.env.BASE_URL||"http://localhost:3000"}/api/analyze-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({imageUrl:r,skipCredits:!0})});if(!i.ok){let e=await i.json();if(402===i.status)throw Error(e.error||"No post generation credits remaining. Please upgrade your plan or purchase more credits.");throw Error("Failed to analyze frame")}return(await i.json()).analysis}async function S(e){try{console.log("[analyze-video] Starting video analysis");let t=e.headers.get("authorization");if(!t)return a.NextResponse.json({error:"Authorization header required"},{status:401});let r=t.replace("Bearer ","");if(!r)return a.NextResponse.json({error:"Invalid user ID"},{status:401});let i=await (0,g.eM)(r),s=(0,b.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);if(i)console.log("\uD83D\uDC51 Admin user - bypassing credit check for video analysis");else{let{data:e,error:t}=await s.from("user_profiles").select("post_generation_credits, subscription_plan").eq("user_id",r).single();if(t&&"PGRST116"===t.code){console.log("User not found in user_profiles table, creating with default credits...");let{data:i,error:n}=await s.from("user_profiles").insert({user_id:r,post_generation_credits:3,subscription_plan:"free"}).select("post_generation_credits, subscription_plan").single();if(n)return console.error("❌ Error creating user profile:",n),a.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:0},{status:402});e=i,t=null}else if(t)return console.error("Error fetching user credits:",t),a.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:0},{status:402});let i=e?.post_generation_credits||0;if(i<=0)return a.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:0},{status:402});console.log("✅ Credit check passed for video analysis. Credits available:",i)}let{videoPath:n}=await w(e);console.log("[analyze-video] Video file saved at:",n);let o="python3",c=f().resolve(process.cwd(),"extract_frames.py");console.log("[analyze-video] Spawning Python script:",o,c,n,30);let h=(0,u.spawn)(o,[c,n,"30"]),d="",p="";h.stdout.on("data",e=>{d+=e.toString()}),h.stderr.on("data",e=>{p+=e.toString()});let _=await new Promise(e=>{h.on("close",e)});if(await l.promises.unlink(n),console.log("[analyze-video] Python script exited with code:",_),0!==_)return console.error("[analyze-video] Python script error:",p),a.NextResponse.json({success:!1,error:p||"Python script failed"},{status:500});let m=[];try{m=JSON.parse(d),console.log("[analyze-video] Extracted frames:",m.length)}catch(e){return console.error("[analyze-video] Failed to parse Python output:",d),a.NextResponse.json({success:!1,error:"Failed to parse Python output",raw:d},{status:500})}let y=m.slice(0,3),v=[];for(let e of y)try{let t=await C(e,r);v.push(t)}catch(e){console.error("[analyze-video] Failed to analyze frame:",e)}if(0===v.length)return console.error("[analyze-video] No frames could be analyzed"),a.NextResponse.json({success:!1,error:"No frames could be analyzed"},{status:500});let k=function(e){let t=e.map(e=>e.caption).join(" | "),r=Array.from(new Set(e.flatMap(e=>e.tags))),i=Object.entries(e.reduce((e,t)=>(e[t.classification]=(e[t.classification]||0)+1,e),{})),s=i.length>0?i.sort((e,t)=>t[1]-e[1])[0][0]:"Scene";return{caption:t,classification:s,tags:r,confidence:e.reduce((e,t)=>e+(t.confidence||0),0)/e.length}}(v),S={businessContext:"Video/Reel for social media content creation and posting",platform:"instagram",theme:"reel",customPrompt:`This is a video/reel. The main visual content is: ${k.caption}`,tone:"friendly",targetAudience:"General audience",niche:"General"};console.log("[analyze-video] Calling generate-video-content API with request:",S);let P=await fetch(`${process.env.BASE_URL||"http://localhost:3000"}/api/generate-video-content`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({request:{...S,customPrompt:S.customPrompt}})});console.log("[analyze-video] Video content generation response:",P.status);let x="",z=[];if(P.ok){let e=await P.json();x=e.result.caption,z=e.result.hashtags,console.log("[analyze-video] Generated caption:",x),console.log("[analyze-video] Generated hashtags:",z)}else{let e=await P.json();console.error("[analyze-video] Content generation failed:",e)}return a.NextResponse.json({success:!0,aggregated_analysis:k,frame_analyses:v,generated:{caption:x,hashtags:z}})}catch(e){return console.error("[analyze-video] Handler error:",e),a.NextResponse.json({success:!1,error:e.message||"Failed to process video",stack:e.stack},{status:500})}}let P=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analyze-video/route",pathname:"/api/analyze-video",filename:"route",bundlePath:"app/api/analyze-video/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/analyze-video/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:x,workUnitAsyncStorage:z,serverHooks:A}=P;function T(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:z})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},21353:function(e){"use strict";function t(e){let t;for(;;)switch(e){case"utf-8":case"utf8":return r.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return r.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return r.utf16le;case"base64":return r.base64;default:if(void 0===t){t=!0,e=e.toLowerCase();continue}return r.other.bind(e)}}let r={utf8:(e,t)=>{if(0===e.length)return"";if("string"==typeof e){if(t<2)return e;e=Buffer.from(e,"latin1")}return e.utf8Slice(0,e.length)},latin1:(e,t)=>0===e.length?"":"string"==typeof e?e:e.latin1Slice(0,e.length),utf16le:(e,t)=>0===e.length?"":("string"==typeof e&&(e=Buffer.from(e,"latin1")),e.ucs2Slice(0,e.length)),base64:(e,t)=>0===e.length?"":("string"==typeof e&&(e=Buffer.from(e,"latin1")),e.base64Slice(0,e.length)),other:(e,t)=>{if(0===e.length)return"";"string"==typeof e&&(e=Buffer.from(e,"latin1"));try{return new TextDecoder(this).decode(e)}catch{}}};function i(e,r,i){let s=t(r);if(s)return s(e,i)}let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];e.exports={basename:function(e){if("string"!=typeof e)return"";for(let t=e.length-1;t>=0;--t)switch(e.charCodeAt(t)){case 47:case 92:return".."===(e=e.slice(t+1))||"."===e?"":e}return".."===e||"."===e?"":e},convertToUTF8:i,getDecoder:t,parseContentType:function(e){if(0===e.length)return;let t=Object.create(null),r=0;for(;r<e.length;++r){let t=e.charCodeAt(r);if(1!==s[t]){if(47!==t||0===r)return;break}}if(r===e.length)return;let i=e.slice(0,r).toLowerCase(),o=++r;for(;r<e.length;++r)if(1!==s[e.charCodeAt(r)]){if(r===o||void 0===function(e,t,r){for(;t<e.length;){let i,o;for(;t<e.length;++t){let r=e.charCodeAt(t);if(32!==r&&9!==r)break}if(t===e.length)break;if(59!==e.charCodeAt(t++))return;for(;t<e.length;++t){let r=e.charCodeAt(t);if(32!==r&&9!==r)break}if(t===e.length)return;let a=t;for(;t<e.length;++t){let r=e.charCodeAt(t);if(1!==s[r]){if(61!==r)return;break}}if(t===e.length||(i=e.slice(a,t),++t===e.length))return;let l="";if(34===e.charCodeAt(t)){o=++t;let r=!1;for(;t<e.length;++t){let i=e.charCodeAt(t);if(92===i){r?(o=t,r=!1):(l+=e.slice(o,t),r=!0);continue}if(34===i){if(r){o=t,r=!1;continue}l+=e.slice(o,t);break}if(r&&(o=t-1,r=!1),1!==n[i])return}if(t===e.length)return;++t}else{for(o=t;t<e.length;++t)if(1!==s[e.charCodeAt(t)]){if(t===o)return;break}l=e.slice(o,t)}void 0===r[i=i.toLowerCase()]&&(r[i]=l)}return r}(e,r,t))return;break}if(r!==o)return{type:i,subtype:e.slice(o,r).toLowerCase(),params:t}},parseDisposition:function(e,t){if(0===e.length)return;let r=Object.create(null),c=0;for(;c<e.length;++c)if(1!==s[e.charCodeAt(c)]){if(void 0===function(e,t,r,c){for(;t<e.length;){let h,f,u;for(;t<e.length;++t){let r=e.charCodeAt(t);if(32!==r&&9!==r)break}if(t===e.length)break;if(59!==e.charCodeAt(t++))return;for(;t<e.length;++t){let r=e.charCodeAt(t);if(32!==r&&9!==r)break}if(t===e.length)return;let d=t;for(;t<e.length;++t){let r=e.charCodeAt(t);if(1!==s[r]){if(61===r)break;return}}if(t===e.length)return;let p="";if(42===(h=e.slice(d,t)).charCodeAt(h.length-1)){let r=++t;for(;t<e.length;++t){let r=e.charCodeAt(t);if(1!==o[r]){if(39!==r)return;break}}if(t===e.length)return;for(u=e.slice(r,t),++t;t<e.length&&39!==e.charCodeAt(t);++t);if(t===e.length||++t===e.length)return;f=t;let s=0;for(;t<e.length;++t){let r=e.charCodeAt(t);if(1!==a[r]){if(37===r){let r,i;if(t+2<e.length&&-1!==(r=l[e.charCodeAt(t+1)])&&-1!==(i=l[e.charCodeAt(t+2)])){let n=(r<<4)+i;p+=e.slice(f,t),p+=String.fromCharCode(n),t+=2,f=t+1,n>=128?s=2:0===s&&(s=1);continue}return}break}}if(p+=e.slice(f,t),void 0===(p=i(p,u,s)))return}else{if(++t===e.length)return;if(34===e.charCodeAt(t)){f=++t;let r=!1;for(;t<e.length;++t){let i=e.charCodeAt(t);if(92===i){r?(f=t,r=!1):(p+=e.slice(f,t),r=!0);continue}if(34===i){if(r){f=t,r=!1;continue}p+=e.slice(f,t);break}if(r&&(f=t-1,r=!1),1!==n[i])return}if(t===e.length)return;++t}else{for(f=t;t<e.length;++t)if(1!==s[e.charCodeAt(t)]){if(t===f)return;break}p=e.slice(f,t)}if(void 0===(p=c(p,2)))return}void 0===r[h=h.toLowerCase()]&&(r[h]=p)}return r}(e,c,r,t))return;break}return{type:e.slice(0,c).toLowerCase(),params:r}}}},21820:e=>{"use strict";e.exports=require("os")},22102:e=>{"use strict";function t(e,t,r,i,s){for(let n=0;n<s;++n)if(e[t+n]!==r[i+n])return!1;return!0}class r{constructor(e,t){if("function"!=typeof t)throw Error("Missing match callback");if("string"==typeof e)e=Buffer.from(e);else if(!Buffer.isBuffer(e))throw Error(`Expected Buffer for needle, got ${typeof e}`);let r=e.length;if(this.maxMatches=1/0,this.matches=0,this._cb=t,this._lookbehindSize=0,this._needle=e,this._bufPos=0,this._lookbehind=Buffer.allocUnsafe(r),this._occ=[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r],r>1)for(let t=0;t<r-1;++t)this._occ[e[t]]=r-1-t}reset(){this.matches=0,this._lookbehindSize=0,this._bufPos=0}push(e,r){let s;Buffer.isBuffer(e)||(e=Buffer.from(e,"latin1"));let n=e.length;for(this._bufPos=r||0;s!==n&&this.matches<this.maxMatches;)s=function(e,r){let s=r.length,n=e._needle,o=n.length,a=-e._lookbehindSize,l=o-1,c=n[l],h=s-o,f=e._occ,u=e._lookbehind;if(a<0){for(;a<0&&a<=h;){let t=a+l,s=t<0?u[e._lookbehindSize+t]:r[t];if(s===c&&i(e,r,a,l))return e._lookbehindSize=0,++e.matches,a>-e._lookbehindSize?e._cb(!0,u,0,e._lookbehindSize+a,!1):e._cb(!0,void 0,0,0,!0),e._bufPos=a+o;a+=f[s]}for(;a<0&&!i(e,r,a,s-a);)++a;if(a<0){let t=e._lookbehindSize+a;return t>0&&e._cb(!1,u,0,t,!1),e._lookbehindSize-=t,u.copy(u,0,t,e._lookbehindSize),u.set(r,e._lookbehindSize),e._lookbehindSize+=s,e._bufPos=s,s}e._cb(!1,u,0,e._lookbehindSize,!1),e._lookbehindSize=0}a+=e._bufPos;let d=n[0];for(;a<=h;){let i=r[a+l];if(i===c&&r[a]===d&&t(n,0,r,a,l))return++e.matches,a>0?e._cb(!0,r,e._bufPos,a,!0):e._cb(!0,void 0,0,0,!0),e._bufPos=a+o;a+=f[i]}for(;a<s;){if(r[a]!==d||!t(r,a,n,0,s-a)){++a;continue}r.copy(u,0,a,s),e._lookbehindSize=s-a;break}return a>0&&e._cb(!1,r,e._bufPos,a<s?a:s,!0),e._bufPos=s,s}(this,e);return s}destroy(){let e=this._lookbehindSize;e&&this._cb(!1,this._lookbehind,0,e,!1),this.reset()}}function i(e,t,r,i){let s=e._lookbehind,n=e._lookbehindSize,o=e._needle;for(let e=0;e<i;++e,++r)if((r<0?s[n+r]:t[r])!==o[e])return!1;return!0}e.exports=r},27910:e=>{"use strict";e.exports=require("stream")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},34728:(e,t,r)=>{"use strict";let{parseContentType:i}=r(21353),s=[r(78602),r(67333)].filter(function(e){return"function"==typeof e.detect});e.exports=e=>{if(("object"!=typeof e||null===e)&&(e={}),"object"!=typeof e.headers||null===e.headers||"string"!=typeof e.headers["content-type"])throw Error("Missing Content-Type");return function(e){let t=e.headers,r=i(t["content-type"]);if(!r)throw Error("Malformed content type");for(let i of s){if(!i.detect(r))continue;let s={limits:e.limits,headers:t,conType:r,highWaterMark:void 0,fileHwm:void 0,defCharset:void 0,defParamCharset:void 0,preservePath:!1};return e.highWaterMark&&(s.highWaterMark=e.highWaterMark),e.fileHwm&&(s.fileHwm=e.fileHwm),s.defCharset=e.defCharset,s.defParamCharset=e.defParamCharset,s.preservePath=e.preservePath,new i(s)}throw Error(`Unsupported content type: ${t["content-type"]}`)}(e)}},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},49485:(e,t,r)=>{"use strict";r.d(t,{CX:()=>l,X2:()=>o,eM:()=>a});let i=(0,r(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),s=new Map;function n(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}async function o(e){try{if(!n(e))return console.error("❌ Invalid UUID format for admin check:",e),!1;let t=s.get(e);if(t&&Date.now()-t.timestamp<3e5)return console.log("\uD83D\uDD0D Using cached admin check for user:",e,"Result:",t.isAdmin),t.isAdmin;console.log("\uD83D\uDD0D Checking admin access for user:",e);let{data:r,error:o}=await i.rpc("get_user_admin_info",{user_uuid:e});if(o)return console.error("❌ Admin check error:",o),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;if(!r||!Array.isArray(r)||0===r.length)return console.log("ℹ️ No admin info found for user:",e),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let a=r[0];if("boolean"!=typeof a.is_admin||"boolean"!=typeof a.is_active)return console.error("❌ Invalid admin data structure:",a),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let l=a.is_admin&&a.is_active;return console.log("✅ Admin check result:",{userId:e,isAdmin:l,role:a.role,isActive:a.is_active}),s.set(e,{isAdmin:l,timestamp:Date.now()}),l}catch(t){return console.error("❌ Error checking admin access:",t),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1}}async function a(e){return await o(e)}async function l(e){try{if(!n(e))return console.error("❌ Invalid UUID format for admin info check:",e),{isAdmin:!1};let{data:t,error:r}=await i.rpc("get_user_admin_info",{user_uuid:e});if(r||!t||!Array.isArray(t)||0===t.length)return{isAdmin:!1};let s=t[0];if("boolean"!=typeof s.is_admin||"boolean"!=typeof s.is_active)return console.error("❌ Invalid admin data structure:",s),{isAdmin:!1};return{isAdmin:s.is_admin&&s.is_active,role:s.role,permissions:s.permissions}}catch(e){return console.error("Error getting admin info:",e),{isAdmin:!1}}}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67333:(e,t,r)=>{"use strict";let{Writable:i}=r(27910),{getDecoder:s}=r(21353);class n extends i{constructor(e){super({autoDestroy:!0,emitClose:!0,highWaterMark:"number"==typeof e.highWaterMark?e.highWaterMark:void 0});let t=e.defCharset||"utf8";e.conType.params&&"string"==typeof e.conType.params.charset&&(t=e.conType.params.charset),this.charset=t;let r=e.limits;this.fieldSizeLimit=r&&"number"==typeof r.fieldSize?r.fieldSize:1048576,this.fieldsLimit=r&&"number"==typeof r.fields?r.fields:1/0,this.fieldNameSizeLimit=r&&"number"==typeof r.fieldNameSize?r.fieldNameSize:100,this._inKey=!0,this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,this._fields=0,this._key="",this._val="",this._byte=-2,this._lastPos=0,this._encode=0,this._decoder=s(t)}static detect(e){return"application"===e.type&&"x-www-form-urlencoded"===e.subtype}_write(e,t,r){if(this._fields>=this.fieldsLimit)return r();let i=0,s=e.length;if(this._lastPos=0,-2!==this._byte){if(-1===(i=o(this,e,i,s)))return r(Error("Malformed urlencoded form"));if(i>=s)return r();this._inKey?++this._bytesKey:++this._bytesVal}e:for(;i<s;)if(this._inKey){for(i=a(this,e,i,s);i<s;){switch(e[i]){case 61:this._lastPos<i&&(this._key+=e.latin1Slice(this._lastPos,i)),this._lastPos=++i,this._key=this._decoder(this._key,this._encode),this._encode=0,this._inKey=!1;continue e;case 38:if(this._lastPos<i&&(this._key+=e.latin1Slice(this._lastPos,i)),this._lastPos=++i,this._key=this._decoder(this._key,this._encode),this._encode=0,this._bytesKey>0&&this.emit("field",this._key,"",{nameTruncated:this._keyTrunc,valueTruncated:!1,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),r();continue;case 43:this._lastPos<i&&(this._key+=e.latin1Slice(this._lastPos,i)),this._key+=" ",this._lastPos=i+1;break;case 37:if(0===this._encode&&(this._encode=1),this._lastPos<i&&(this._key+=e.latin1Slice(this._lastPos,i)),this._lastPos=i+1,this._byte=-1,-1===(i=o(this,e,i+1,s)))return r(Error("Malformed urlencoded form"));if(i>=s)return r();++this._bytesKey,i=a(this,e,i,s);continue}++i,++this._bytesKey,i=a(this,e,i,s)}this._lastPos<i&&(this._key+=e.latin1Slice(this._lastPos,i))}else{for(i=l(this,e,i,s);i<s;){switch(e[i]){case 38:if(this._lastPos<i&&(this._val+=e.latin1Slice(this._lastPos,i)),this._lastPos=++i,this._inKey=!0,this._val=this._decoder(this._val,this._encode),this._encode=0,(this._bytesKey>0||this._bytesVal>0)&&this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),r();continue e;case 43:this._lastPos<i&&(this._val+=e.latin1Slice(this._lastPos,i)),this._val+=" ",this._lastPos=i+1;break;case 37:if(0===this._encode&&(this._encode=1),this._lastPos<i&&(this._val+=e.latin1Slice(this._lastPos,i)),this._lastPos=i+1,this._byte=-1,-1===(i=o(this,e,i+1,s)))return r(Error("Malformed urlencoded form"));if(i>=s)return r();++this._bytesVal,i=l(this,e,i,s);continue}++i,++this._bytesVal,i=l(this,e,i,s)}this._lastPos<i&&(this._val+=e.latin1Slice(this._lastPos,i))}r()}_final(e){if(-2!==this._byte)return e(Error("Malformed urlencoded form"));(!this._inKey||this._bytesKey>0||this._bytesVal>0)&&(this._inKey?this._key=this._decoder(this._key,this._encode):this._val=this._decoder(this._val,this._encode),this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"})),e()}}function o(e,t,r,i){if(r>=i)return i;if(-1===e._byte){let s=c[t[r++]];if(-1===s)return -1;if(s>=8&&(e._encode=2),r<i){let i=c[t[r++]];if(-1===i)return -1;e._inKey?e._key+=String.fromCharCode((s<<4)+i):e._val+=String.fromCharCode((s<<4)+i),e._byte=-2,e._lastPos=r}else e._byte=s}else{let i=c[t[r++]];if(-1===i)return -1;e._inKey?e._key+=String.fromCharCode((e._byte<<4)+i):e._val+=String.fromCharCode((e._byte<<4)+i),e._byte=-2,e._lastPos=r}return r}function a(e,t,r,i){if(e._bytesKey>e.fieldNameSizeLimit){for(!e._keyTrunc&&e._lastPos<r&&(e._key+=t.latin1Slice(e._lastPos,r-1)),e._keyTrunc=!0;r<i;++r){let i=t[r];if(61===i||38===i)break;++e._bytesKey}e._lastPos=r}return r}function l(e,t,r,i){if(e._bytesVal>e.fieldSizeLimit){for(!e._valTrunc&&e._lastPos<r&&(e._val+=t.latin1Slice(e._lastPos,r-1)),e._valTrunc=!0;r<i&&38!==t[r];++r)++e._bytesVal;e._lastPos=r}return r}let c=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];e.exports=n},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},78602:(e,t,r)=>{"use strict";let{Readable:i,Writable:s}=r(27910),n=r(22102),{basename:o,convertToUTF8:a,getDecoder:l,parseContentType:c,parseDisposition:h}=r(21353),f=Buffer.from("\r\n"),u=Buffer.from("\r"),d=Buffer.from("-");function p(){}class _{constructor(e){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=0,this.name="",this.value="",this.crlf=0,this.cb=e}reset(){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=0,this.name="",this.value="",this.crlf=0}push(e,t,r){let i=t;for(;t<r;)switch(this.state){case 0:{let s=!1;for(;t<r;++t){if(16384===this.byteCount)return -1;++this.byteCount;let r=e[t];if(1!==w[r]){if(58!==r||(this.name+=e.latin1Slice(i,t),0===this.name.length))return -1;++t,s=!0,this.state=1;break}}if(!s){this.name+=e.latin1Slice(i,t);break}}case 1:{let s=!1;for(;t<r;++t){if(16384===this.byteCount)return -1;++this.byteCount;let r=e[t];if(32!==r&&9!==r){i=t,s=!0,this.state=2;break}}if(!s)break}case 2:switch(this.crlf){case 0:for(;t<r;++t){if(16384===this.byteCount)return -1;++this.byteCount;let r=e[t];if(1!==C[r]){if(13!==r)return -1;++this.crlf;break}}this.value+=e.latin1Slice(i,t++);break;case 1:if(16384===this.byteCount||(++this.byteCount,10!==e[t++]))return -1;++this.crlf;break;case 2:{if(16384===this.byteCount)return -1;++this.byteCount;let r=e[t];32===r||9===r?(i=t,this.crlf=0):(++this.pairCount<2e3&&(this.name=this.name.toLowerCase(),void 0===this.header[this.name]?this.header[this.name]=[this.value]:this.header[this.name].push(this.value)),13===r?(++this.crlf,++t):(i=t,this.crlf=0,this.state=0,this.name="",this.value=""));break}case 3:{if(16384===this.byteCount||(++this.byteCount,10!==e[t++]))return -1;let r=this.header;return this.reset(),this.cb(r),t}}}return t}}class m extends i{constructor(e,t){super(e),this.truncated=!1,this._readcb=null,this.once("end",()=>{if(this._read(),0==--t._fileEndsLeft&&t._finalcb){let e=t._finalcb;t._finalcb=null,process.nextTick(e)}})}_read(e){let t=this._readcb;t&&(this._readcb=null,t())}}let y={push:(e,t)=>{},destroy:()=>{}};function b(e,t){return e}class g extends s{constructor(e){let t,r,i,s,g;if(super({autoDestroy:!0,emitClose:!0,highWaterMark:"number"==typeof e.highWaterMark?e.highWaterMark:void 0}),!e.conType.params||"string"!=typeof e.conType.params.boundary)throw Error("Multipart: Boundary not found");let v=e.conType.params.boundary,k="string"==typeof e.defParamCharset&&e.defParamCharset?l(e.defParamCharset):b,w=e.defCharset||"utf8",C=e.preservePath,S={autoDestroy:!0,emitClose:!0,highWaterMark:"number"==typeof e.fileHwm?e.fileHwm:void 0},P=e.limits,x=P&&"number"==typeof P.fieldSize?P.fieldSize:1048576,z=P&&"number"==typeof P.fileSize?P.fileSize:1/0,A=P&&"number"==typeof P.files?P.files:1/0,T=P&&"number"==typeof P.fields?P.fields:1/0,E=P&&"number"==typeof P.parts?P.parts:1/0,j=-1,L=0,M=0,R=!1;this._fileEndsLeft=0,this._fileStream=void 0,this._complete=!1;let q=0,B=0,N=!1,U=!1,K=!1;this._hparser=null;let D=new _(e=>{let n;if(this._hparser=null,R=!1,s="text/plain",r=w,i="7bit",g=void 0,N=!1,!e["content-disposition"]){R=!0;return}let a=h(e["content-disposition"][0],k);if(!a||"form-data"!==a.type){R=!0;return}if(a.params&&(a.params.name&&(g=a.params.name),a.params["filename*"]?n=a.params["filename*"]:a.params.filename&&(n=a.params.filename),void 0===n||C||(n=o(n))),e["content-type"]){let t=c(e["content-type"][0]);t&&(s=`${t.type}/${t.subtype}`,t.params&&"string"==typeof t.params.charset&&(r=t.params.charset.toLowerCase()))}if(e["content-transfer-encoding"]&&(i=e["content-transfer-encoding"][0].toLowerCase()),"application/octet-stream"===s||void 0!==n){if(M===A){U||(U=!0,this.emit("filesLimit")),R=!0;return}if(++M,0===this.listenerCount("file")){R=!0;return}q=0,this._fileStream=new m(S,this),++this._fileEndsLeft,this.emit("file",g,this._fileStream,{filename:n,encoding:i,mimeType:s})}else{if(L===T){K||(K=!0,this.emit("fieldsLimit")),R=!0;return}if(++L,0===this.listenerCount("field")){R=!0;return}t=[],B=0}}),O=0,V=(e,n,o,l,c)=>{for(;n;){if(null!==this._hparser){let e=this._hparser.push(n,o,l);if(-1===e){this._hparser=null,D.reset(),this.emit("error",Error("Malformed part header"));break}o=e}if(o===l)break;if(0!==O){if(1===O){switch(n[o]){case 45:O=2,++o;break;case 13:O=3,++o;break;default:O=0}if(o===l)return}if(2===O){if(O=0,45===n[o]){this._complete=!0,this._bparser=y;return}let e=this._writecb;this._writecb=p,V(!1,d,0,1,!1),this._writecb=e}else if(3===O){if(O=0,10===n[o]){if(++o,j>=E||(this._hparser=D,o===l))break;continue}{let e=this._writecb;this._writecb=p,V(!1,u,0,1,!1),this._writecb=e}}}if(!R){if(this._fileStream){let e,t=Math.min(l-o,z-q);c?e=n.slice(o,o+t):(e=Buffer.allocUnsafe(t),n.copy(e,0,o,o+t)),(q+=e.length)===z?(e.length>0&&this._fileStream.push(e),this._fileStream.emit("limit"),this._fileStream.truncated=!0,R=!0):this._fileStream.push(e)||(this._writecb&&(this._fileStream._readcb=this._writecb),this._writecb=null)}else if(void 0!==t){let e,r=Math.min(l-o,x-B);c?e=n.slice(o,o+r):(e=Buffer.allocUnsafe(r),n.copy(e,0,o,o+r)),B+=r,t.push(e),B===x&&(R=!0,N=!0)}}break}if(e){if(O=1,this._fileStream)this._fileStream.push(null),this._fileStream=null;else if(void 0!==t){let e;switch(t.length){case 0:e="";break;case 1:e=a(t[0],r,0);break;default:e=a(Buffer.concat(t,B),r,0)}t=void 0,B=0,this.emit("field",g,e,{nameTruncated:!1,valueTruncated:N,encoding:i,mimeType:s})}++j===E&&this.emit("partsLimit")}};this._bparser=new n(`\r
--${v}`,V),this._writecb=null,this._finalcb=null,this.write(f)}static detect(e){return"multipart"===e.type&&"form-data"===e.subtype}_write(e,t,r){this._writecb=r,this._bparser.push(e,0),this._writecb&&function(e,t){let r=e._writecb;e._writecb=null,r&&r()}(this)}_destroy(e,t){this._hparser=null,this._bparser=y,e||(e=k(this));let r=this._fileStream;r&&(this._fileStream=null,r.destroy(e)),t(e)}_final(e){if(this._bparser.destroy(),!this._complete)return e(Error("Unexpected end of form"));this._fileEndsLeft?this._finalcb=v.bind(null,this,e):v(this,e)}}function v(e,t,r){if(r)return t(r);t(r=k(e))}function k(e){if(e._hparser)return Error("Malformed part header");let t=e._fileStream;if(t&&(e._fileStream=null,t.destroy(Error("Unexpected end of file"))),!e._complete)return Error("Unexpected end of form")}let w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];e.exports=g},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4447,580,6437],()=>r(10523));module.exports=i})();