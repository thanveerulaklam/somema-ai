(()=>{var e={};e.id=923,e.ids=[923],e.modules={2449:(e,t,o)=>{"use strict";o.r(t),o.d(t,{patchFetch:()=>A,routeModule:()=>x,serverHooks:()=>w,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>y});var r={};o.r(r),o.d(r,{POST:()=>p});var s=o(96559),n=o(48088),a=o(37719),i=o(32190),l=o(66437),c=o(49485),u=o(45389),d=o(68803);async function p(e){try{let t,o,r,s=e.headers.get("authorization");if(!s)return i.NextResponse.json({error:"Authorization header required"},{status:401});if(!s.startsWith("Bearer "))return i.NextResponse.json({error:"Invalid authorization format"},{status:401});{let e=s.substring(7);try{let{data:{user:o},error:r}=await (0,l.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY).auth.getUser(e);t=r||!o?e:o.id}catch(o){t=e}}if(!t)return i.NextResponse.json({error:"User not found"},{status:401});let{type:n,request:a}=await e.json();if(!n||!a)return i.NextResponse.json({error:"Type and request are required"},{status:400});let p=(0,d.oI)(n,{required:!0,allowedValues:["caption","hashtags","textElements","imagePrompt"]});if(!p.isValid)return i.NextResponse.json({error:"Invalid type parameter",details:p.errors},{status:400});let x=(0,d.UT)(a);if(!x.isValid)return console.error("Business context validation failed:",x.errors),console.error("Request data:",a),i.NextResponse.json({error:"Invalid request data",details:x.errors},{status:400});if(await (0,c.eM)(t))console.log("\uD83D\uDC51 Admin user - bypassing credit check for content generation"),o={success:!0,newBalance:999999};else{let e=await (0,u.rZ)(t);if(!e.success)return i.NextResponse.json({error:"Failed to initialize user profile",details:e.error},{status:500});let r=(0,l.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:s,error:n}=await r.from("user_profiles").select("post_generation_credits").eq("user_id",t).single();if(n||!s)return i.NextResponse.json({error:"Failed to fetch user credits",creditsRemaining:0},{status:500});let a=s.post_generation_credits||0;if(a<1)return i.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:a},{status:402});let{error:c}=await r.from("user_profiles").update({post_generation_credits:a-1,updated_at:new Date().toISOString()}).eq("user_id",t);if(c)return console.error("Credit deduction error:",c),i.NextResponse.json({error:"Failed to deduct credits",creditsRemaining:a},{status:500});o={success:!0,newBalance:a-1},console.log("✅ Credit deduction successful. New balance:",o.newBalance)}let _=process.env.OPENAI_API_KEY;if(!_)return i.NextResponse.json({error:"OpenAI API key not configured"},{status:500});switch(n){case"caption":r=await g(a,_);break;case"hashtags":r=await m(a,_);break;case"textElements":r=await h(a,_);break;case"imagePrompt":r=await f(a,_);break;default:return i.NextResponse.json({error:"Invalid type"},{status:400})}return i.NextResponse.json({success:!0,result:r,creditsRemaining:o.newBalance})}catch(e){return console.error("Content generation error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e,t){let o=function(e){if(!e)return"Create an engaging social media caption for Instagram that drives engagement and encourages interaction.";let{businessContext:t,platform:o,theme:r,customPrompt:s,tone:n,targetAudience:a,niche:i}=e;return s&&s.includes("IMAGE CONTENT:")?s:`Create an engaging social media caption for ${o||"Instagram"} that:
  
Business Context: ${t}
Content Theme: ${r}
Tone: ${n||"Professional and friendly"}
Target Audience: ${a||"General audience"}
Industry/Niche: ${i||"Business"}

The caption must mention the business name: ${t} and niche: ${i}.

${s?`Additional Context: ${s}`:""}

Requirements:
- Optimized for ${o} platform
- Engaging and authentic tone
- Include relevant emojis
- Encourage interaction
- Keep it concise but impactful
- Match the ${r} theme

Generate a compelling caption that will drive engagement and align with the business context.`}(e);if(!o)throw Error("Failed to create caption prompt");console.log("\uD83D\uDE80 Starting CAPTION generation..."),console.log("\uD83D\uDCCA Request details:"),console.log("  - Model: gpt-4o-mini"),console.log("  - Max tokens: 300"),console.log("  - Prompt length:",o.length,"characters");let r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a professional social media content creator specializing in engaging, platform-optimized captions. Create captions that are authentic, engaging, and drive meaningful interactions."},{role:"user",content:o}],max_tokens:300,temperature:.7,presence_penalty:.1,frequency_penalty:.1})});if(console.log("\uD83D\uDCC8 OpenAI API Response Headers:"),console.log("  - Status:",r.status),console.log("  - X-Request-ID:",r.headers.get("x-request-id")),console.log("  - X-RateLimit-Limit:",r.headers.get("x-ratelimit-limit")),console.log("  - X-RateLimit-Remaining:",r.headers.get("x-ratelimit-remaining")),!r.ok)throw Error(`OpenAI API error: ${r.status}`);let s=await r.json();if(s.usage){console.log("\uD83D\uDCB0 CAPTION Generation Usage:"),console.log("  - Input tokens:",s.usage.prompt_tokens),console.log("  - Output tokens:",s.usage.completion_tokens),console.log("  - Total tokens:",s.usage.total_tokens);let e=s.usage.prompt_tokens/1e6*.15,t=s.usage.completion_tokens/1e6*.6,o=e+t;console.log("  - Input cost: $"+e.toFixed(6)),console.log("  - Output cost: $"+t.toFixed(6)),console.log("  - Total cost: $"+o.toFixed(6))}return console.log("✅ CAPTION generation complete!"),s.choices[0].message.content.trim()}async function m(e,t){let o=function(e){if(!e)return"Generate relevant hashtags for Instagram social media post that will increase visibility and engagement.";let{businessContext:t,platform:o,theme:r,customPrompt:s,niche:n}=e;return s&&s.includes("PRODUCT:")?s:`Generate relevant hashtags for a ${o||"Instagram"} post about:
  
Business Context: ${t}
Content Theme: ${r}
Industry/Niche: ${n||"Business"}

${s?`Additional Context: ${s}`:""}

Requirements:
- 8-12 relevant hashtags
- Mix of popular and niche hashtags
- Include industry-specific tags
- Optimized for ${o}
- Trending when possible
- No spaces in hashtags

Return only the hashtags separated by spaces, starting with #.`}(e);if(!o)throw Error("Failed to create hashtag prompt");console.log("\uD83D\uDE80 Starting HASHTAGS generation..."),console.log("\uD83D\uDCCA Request details:"),console.log("  - Model: gpt-4o-mini"),console.log("  - Max tokens: 200"),console.log("  - Prompt length:",o.length,"characters");let r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a social media hashtag expert. Generate relevant, trending hashtags that will increase post visibility and engagement."},{role:"user",content:o}],max_tokens:200,temperature:.7})});if(console.log("\uD83D\uDCC8 OpenAI API Response Headers:"),console.log("  - Status:",r.status),console.log("  - X-Request-ID:",r.headers.get("x-request-id")),!r.ok)throw Error(`OpenAI API error: ${r.status}`);let s=await r.json();if(s.usage){console.log("\uD83D\uDCB0 HASHTAGS Generation Usage:"),console.log("  - Input tokens:",s.usage.prompt_tokens),console.log("  - Output tokens:",s.usage.completion_tokens),console.log("  - Total tokens:",s.usage.total_tokens);let e=s.usage.prompt_tokens/1e6*.15,t=s.usage.completion_tokens/1e6*.6,o=e+t;console.log("  - Input cost: $"+e.toFixed(6)),console.log("  - Output cost: $"+t.toFixed(6)),console.log("  - Total cost: $"+o.toFixed(6))}return console.log("✅ HASHTAGS generation complete!"),(s.choices[0].message.content.trim().match(/#\w+/g)||[]).map(e=>e.substring(1)).slice(0,12)}async function h(e,t){let o=function(e){if(!e)return"Create text elements for a social media visual post with headline, subtext, and call-to-action.";let{businessContext:t,platform:o,theme:r,customPrompt:s,tone:n}=e;return s&&s.includes("PRODUCT:")?s:`Create text elements for a social media visual post about:
  
Business Context: ${t}
Platform: ${o}
Theme: ${r}
Tone: ${n||"Professional and friendly"}

${s?`Additional Context: ${s}`:""}

Generate three text elements in JSON format:
{
  "headline": "Main attention-grabbing headline (short and impactful)",
  "subtext": "Supporting text that provides context or details",
  "cta": "Call-to-action text (e.g., 'Learn More', 'Shop Now', 'Get Started')"
}

Requirements:
- Headline: 3-6 words, bold and impactful
- Subtext: 1-2 sentences, informative
- CTA: 2-3 words, action-oriented
- All text should work together cohesively
- Optimized for ${o} visual content`}(e);if(!o)throw Error("Failed to create text elements prompt");console.log("\uD83D\uDE80 Starting TEXT ELEMENTS generation..."),console.log("\uD83D\uDCCA Request details:"),console.log("  - Model: gpt-4o-mini"),console.log("  - Max tokens: 400"),console.log("  - Prompt length:",o.length,"characters");let r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a professional graphic designer specializing in social media visuals. Generate compelling text elements for social media posts that are clear, impactful, and visually appealing. Always respond with valid JSON format."},{role:"user",content:o}],max_tokens:400,temperature:.7})});if(console.log("\uD83D\uDCC8 OpenAI API Response Headers:"),console.log("  - Status:",r.status),console.log("  - X-Request-ID:",r.headers.get("x-request-id")),!r.ok)throw Error(`OpenAI API error: ${r.status}`);let s=await r.json();if(s.usage){console.log("\uD83D\uDCB0 TEXT ELEMENTS Generation Usage:"),console.log("  - Input tokens:",s.usage.prompt_tokens),console.log("  - Output tokens:",s.usage.completion_tokens),console.log("  - Total tokens:",s.usage.total_tokens);let e=s.usage.prompt_tokens/1e6*.15,t=s.usage.completion_tokens/1e6*.6,o=e+t;console.log("  - Input cost: $"+e.toFixed(6)),console.log("  - Output cost: $"+t.toFixed(6)),console.log("  - Total cost: $"+o.toFixed(6))}console.log("✅ TEXT ELEMENTS generation complete!");let n=s.choices[0].message.content.trim();try{let e=JSON.parse(n);return{headline:e.headline||"Amazing Headline",subtext:e.subtext||"Compelling subtext that draws attention",cta:e.cta||"Learn More"}}catch(e){return console.error("Failed to parse text elements response:",e),{headline:"Amazing Headline",subtext:"Compelling subtext that draws attention",cta:"Learn More"}}}async function f(e,t){let o=function(e){if(!e)return"Create a detailed image generation prompt for a professional social media post.";let{businessContext:t,platform:o,theme:r,customPrompt:s,tone:n}=e;return`Create a detailed image generation prompt for:
  
Business Context: ${t}
Platform: ${o}
Theme: ${r}
Tone: ${n||"Professional and friendly"}

${s?`Additional Context: ${s}`:""}

Requirements:
- Detailed visual description
- Professional quality
- Optimized for ${o}
- Matches the ${r} theme
- High-resolution, social media ready
- Clean, modern aesthetic

Generate a comprehensive prompt that will create a perfect visual for this social media content.`}(e);if(!o)throw Error("Failed to create image prompt");console.log("\uD83D\uDE80 Starting IMAGE PROMPT generation..."),console.log("\uD83D\uDCCA Request details:"),console.log("  - Model: gpt-4o-mini"),console.log("  - Max tokens: 300"),console.log("  - Prompt length:",o.length,"characters");let r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a professional image prompt engineer. Create detailed, specific prompts for AI image generation that will produce high-quality, relevant visuals for social media content."},{role:"user",content:o}],max_tokens:300,temperature:.7})});if(console.log("\uD83D\uDCC8 OpenAI API Response Headers:"),console.log("  - Status:",r.status),console.log("  - X-Request-ID:",r.headers.get("x-request-id")),!r.ok)throw Error(`OpenAI API error: ${r.status}`);let s=await r.json();if(s.usage){console.log("\uD83D\uDCB0 IMAGE PROMPT Generation Usage:"),console.log("  - Input tokens:",s.usage.prompt_tokens),console.log("  - Output tokens:",s.usage.completion_tokens),console.log("  - Total tokens:",s.usage.total_tokens);let e=s.usage.prompt_tokens/1e6*.15,t=s.usage.completion_tokens/1e6*.6,o=e+t;console.log("  - Input cost: $"+e.toFixed(6)),console.log("  - Output cost: $"+t.toFixed(6)),console.log("  - Total cost: $"+o.toFixed(6))}return console.log("✅ IMAGE PROMPT generation complete!"),s.choices[0].message.content.trim()}let x=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/generate-content/route",pathname:"/api/generate-content",filename:"route",bundlePath:"app/api/generate-content/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/generate-content/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:_,workUnitAsyncStorage:y,serverHooks:w}=x;function A(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:y})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45389:(e,t,o)=>{"use strict";o.d(t,{Yy:()=>s,rZ:()=>n});let r=(0,o(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function s(e,t=1){try{let{data:o,error:s}=await r.rpc("atomic_deduct_enhancement_credits",{user_uuid:e,credits_to_deduct:t});if(s)return console.error("Atomic enhancement credit deduction error:",s),{success:!1,newBalance:0,error:s.message};if(!o||0===o.length)return{success:!1,newBalance:0,error:"User not found or insufficient credits"};let n=o[0];if(!n.success)return{success:!1,newBalance:n.current_credits||0,error:n.error||"Insufficient credits"};return{success:!0,newBalance:n.new_credits}}catch(e){return console.error("Enhancement credit deduction error:",e),{success:!1,newBalance:0,error:"Internal server error"}}}async function n(e){try{let{data:t,error:o}=await r.from("user_profiles").select("post_generation_credits, image_enhancement_credits").eq("user_id",e).single();if(t)return{success:!0,credits:{postGenerationCredits:t.post_generation_credits||0,enhancementCredits:t.image_enhancement_credits||0}};if(o&&"PGRST116"!==o.code)return{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:o.message};let s={postGenerationCredits:15,enhancementCredits:3},{data:n,error:a}=await r.from("user_profiles").insert({user_id:e,post_generation_credits:s.postGenerationCredits,image_enhancement_credits:s.enhancementCredits,media_storage_limit:50,subscription_plan:"free"}).select("post_generation_credits, image_enhancement_credits").single();if(a)return console.error("Error creating user profile:",a),{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:a.message};return{success:!0,credits:{postGenerationCredits:n.post_generation_credits,enhancementCredits:n.image_enhancement_credits}}}catch(e){return console.error("Error ensuring user profile:",e),{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:"Internal server error"}}}},47990:()=>{},49485:(e,t,o)=>{"use strict";o.d(t,{CX:()=>l,X2:()=>a,eM:()=>i});let r=(0,o(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),s=new Map;function n(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}async function a(e){try{if(!n(e))return console.error("❌ Invalid UUID format for admin check:",e),!1;let t=s.get(e);if(t&&Date.now()-t.timestamp<3e5)return console.log("\uD83D\uDD0D Using cached admin check for user:",e,"Result:",t.isAdmin),t.isAdmin;console.log("\uD83D\uDD0D Checking admin access for user:",e);let{data:o,error:a}=await r.rpc("get_user_admin_info",{user_uuid:e});if(a)return console.error("❌ Admin check error:",a),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;if(!o||!Array.isArray(o)||0===o.length)return console.log("ℹ️ No admin info found for user:",e),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let i=o[0];if("boolean"!=typeof i.is_admin||"boolean"!=typeof i.is_active)return console.error("❌ Invalid admin data structure:",i),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let l=i.is_admin&&i.is_active;return console.log("✅ Admin check result:",{userId:e,isAdmin:l,role:i.role,isActive:i.is_active}),s.set(e,{isAdmin:l,timestamp:Date.now()}),l}catch(t){return console.error("❌ Error checking admin access:",t),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1}}async function i(e){return await a(e)}async function l(e){try{if(!n(e))return console.error("❌ Invalid UUID format for admin info check:",e),{isAdmin:!1};let{data:t,error:o}=await r.rpc("get_user_admin_info",{user_uuid:e});if(o||!t||!Array.isArray(t)||0===t.length)return{isAdmin:!1};let s=t[0];if("boolean"!=typeof s.is_admin||"boolean"!=typeof s.is_active)return console.error("❌ Invalid admin data structure:",s),{isAdmin:!1};return{isAdmin:s.is_admin&&s.is_active,role:s.role,permissions:s.permissions}}catch(e){return console.error("Error getting admin info:",e),{isAdmin:!1}}}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68803:(e,t,o)=>{"use strict";function r(e,t={}){let o=[],s=e;return t.required&&(null==e||""===e)?(o.push("This field is required"),{isValid:!1,errors:o}):t.required||null!=e&&""!==e?(s=String(e).trim(),t.sanitize&&(s=s.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"")),t.minLength&&s.length<t.minLength&&o.push(`Minimum length is ${t.minLength} characters`),t.maxLength&&s.length>t.maxLength&&o.push(`Maximum length is ${t.maxLength} characters`),t.pattern&&!t.pattern.test(s)&&o.push("Invalid format"),t.allowedValues&&!t.allowedValues.includes(s)&&o.push(`Must be one of: ${t.allowedValues.join(", ")}`),{isValid:0===o.length,errors:o,sanitizedData:s}):{isValid:!0,errors:[],sanitizedData:""}}function s(e,t={}){let o=[];if(t.required&&!e)return o.push("File is required"),{isValid:!1,errors:o};if(!e)return{isValid:!0,errors:[],sanitizedData:null};if(!(e instanceof File))return o.push("Invalid file object"),{isValid:!1,errors:o};if(t.maxSize&&e.size>t.maxSize){let e=Math.round(t.maxSize/1048576);o.push(`File size must be less than ${e}MB`)}return t.allowedTypes&&!t.allowedTypes.includes(e.type)&&o.push(`File type must be one of: ${t.allowedTypes.join(", ")}`),{isValid:0===o.length,errors:o,sanitizedData:e}}function n(e){return function(e,t){let o=[],r={};if("object"!=typeof e||null===e||Array.isArray(e))return{isValid:!1,errors:["Input must be a valid object"]};for(let[s,n]of Object.entries(t)){let t=n(e[s]);t.isValid?r[s]=t.sanitizedData:o.push(...t.errors.map(e=>`${s}: ${e}`))}return{isValid:0===o.length,errors:o,sanitizedData:r}}(e,{businessContext:e=>r(e,{required:!0,minLength:3,maxLength:500,sanitize:!0}),platform:e=>r(e,{allowedValues:["instagram","facebook","twitter","linkedin","tiktok"]}),theme:e=>r(e,{maxLength:100,sanitize:!0}),tone:e=>r(e,{allowedValues:["professional","casual","friendly","authoritative","playful","inspiring"]}),targetAudience:e=>r(e,{maxLength:200,sanitize:!0}),niche:e=>r(e,{maxLength:100,sanitize:!0})})}o.d(t,{UT:()=>n,nJ:()=>s,oI:()=>r})},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[4447,580,6437],()=>o(2449));module.exports=r})();