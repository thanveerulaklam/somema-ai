"use strict";(()=>{var e={};e.id=2204,e.ids=[2204],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{e.exports=require("punycode")},13062:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(96559),n=t(48088),a=t(37719),i=t(32190),l=t(28695),p=t(66437),u=t(49485);async function c(e){try{let{imageAnalysis:r,businessProfile:t}=await e.json();if(!r||!t)return i.NextResponse.json({error:"Missing required parameters: imageAnalysis and businessProfile"},{status:400});let s=e.headers.get("authorization");if(!s)return i.NextResponse.json({error:"Authorization header required"},{status:401});let o=s.replace("Bearer ","");if(!o)return i.NextResponse.json({error:"Invalid user ID"},{status:401});let n=await (0,u.eM)(o),a=await (0,u.CX)(o);console.log("\uD83D\uDD10 Admin check result:",{userId:o,bypassCredits:n,adminInfo:a});let c=(0,p.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),g=0,d=null;if(n){let{data:e}=await c.from("user_profiles").select("post_generation_credits, subscription_plan").eq("user_id",o).single();d=e,g=d?.post_generation_credits||0,console.log("\uD83D\uDC51 Admin user - bypassing credit check. Current credits:",g)}else{let{data:e,error:r}=await c.from("user_profiles").select("post_generation_credits, subscription_plan").eq("user_id",o).gte("post_generation_credits",1).single();if(r)return console.error("Error fetching user credits:",r),i.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:0},{status:402});if(d=e,(g=d?.post_generation_credits||0)<=0)return i.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:0},{status:402})}console.log("\uD83D\uDE80 Starting INSTAGRAM POST GENERATION..."),console.log("\uD83D\uDCCA Request details:"),console.log("  - User ID:",o),console.log("  - Credits before:",g),console.log("  - Product type:",r.classification),console.log("  - Business:",t.business_name),console.log("  - Niche:",t.niche);let m=await (0,l.fX)(r,t);console.log("âœ… Generated Instagram content:",m),console.log("\uD83D\uDCCB Post Generation Summary:"),console.log("  - Caption length:",m.caption.length,"characters"),console.log("  - Hashtags count:",m.hashtags.length);let x=n?g:g-1;if(console.log("  - Credits after:",x),console.log("  - Admin bypass:",n),n)console.log("\uD83D\uDC51 Admin user - skipping credit decrement and generation log");else try{let{error:e}=await c.from("user_profiles").update({post_generation_credits:x}).eq("user_id",o);e&&console.error("Failed to update user credits:",e),await c.from("generation_logs").insert({user_id:o,type:"single"})}catch(e){console.error("Failed to log single generation:",e)}return i.NextResponse.json({success:!0,result:m,creditsRemaining:x})}catch(e){return console.error("Error generating Instagram content:",e),i.NextResponse.json({error:e.message||"Failed to generate Instagram content"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/generate-instagram-content/route",pathname:"/api/generate-instagram-content",filename:"route",bundlePath:"app/api/generate-instagram-content/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/generate-instagram-content/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:x}=g;function h(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},27910:e=>{e.exports=require("stream")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{e.exports=require("tls")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6437,7774],()=>t(13062));module.exports=s})();