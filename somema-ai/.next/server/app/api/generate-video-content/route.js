(()=>{var e={};e.id=2337,e.ids=[2337],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45389:(e,t,r)=>{"use strict";r.d(t,{Yy:()=>s,rZ:()=>i});let n=(0,r(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function s(e,t=1){try{let{data:r,error:s}=await n.rpc("atomic_deduct_enhancement_credits",{user_uuid:e,credits_to_deduct:t});if(s)return console.error("Atomic enhancement credit deduction error:",s),{success:!1,newBalance:0,error:s.message};if(!r||0===r.length)return{success:!1,newBalance:0,error:"User not found or insufficient credits"};let i=r[0];if(!i.success)return{success:!1,newBalance:i.current_credits||0,error:i.error||"Insufficient credits"};return{success:!0,newBalance:i.new_credits}}catch(e){return console.error("Enhancement credit deduction error:",e),{success:!1,newBalance:0,error:"Internal server error"}}}async function i(e){try{let{data:t,error:r}=await n.from("user_profiles").select("post_generation_credits, image_enhancement_credits").eq("user_id",e).single();if(t)return{success:!0,credits:{postGenerationCredits:t.post_generation_credits||0,enhancementCredits:t.image_enhancement_credits||0}};if(r&&"PGRST116"!==r.code)return{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:r.message};let s={postGenerationCredits:15,enhancementCredits:3},{data:i,error:a}=await n.from("user_profiles").insert({user_id:e,post_generation_credits:s.postGenerationCredits,image_enhancement_credits:s.enhancementCredits,media_storage_limit:50,subscription_plan:"free"}).select("post_generation_credits, image_enhancement_credits").single();if(a)return console.error("Error creating user profile:",a),{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:a.message};return{success:!0,credits:{postGenerationCredits:i.post_generation_credits,enhancementCredits:i.image_enhancement_credits}}}catch(e){return console.error("Error ensuring user profile:",e),{success:!1,credits:{postGenerationCredits:0,enhancementCredits:0},error:"Internal server error"}}}},46429:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>h,serverHooks:()=>y,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>_});var n={};r.r(n),r.d(n,{POST:()=>p});var s=r(96559),i=r(48088),a=r(37719),o=r(32190),c=r(66437),u=r(49485),l=r(45389),d=r(68803);async function p(e){try{let t,r,n=e.headers.get("authorization");if(!n)return o.NextResponse.json({error:"Authorization header required"},{status:401});if(!n.startsWith("Bearer "))return o.NextResponse.json({error:"Invalid authorization format"},{status:401});{let e=n.substring(7);try{let{data:{user:r},error:n}=await (0,c.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY).auth.getUser(e);t=n||!r?e:r.id}catch(r){t=e}}if(!t)return o.NextResponse.json({error:"User not found"},{status:401});let{request:s}=await e.json(),i=(0,d.UT)(s);if(!i.isValid)return console.error("Business context validation failed:",i.errors),console.error("Request data:",s),o.NextResponse.json({error:"Invalid request data",details:i.errors},{status:400});if(await (0,u.eM)(t))console.log("\uD83D\uDC51 Admin user - bypassing credit check for content generation"),r={success:!0,newBalance:999999};else{let e=await (0,l.rZ)(t);if(!e.success)return o.NextResponse.json({error:"Failed to initialize user profile",details:e.error},{status:500});let n=(0,c.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:s,error:i}=await n.from("user_profiles").select("post_generation_credits").eq("user_id",t).single();if(i||!s)return o.NextResponse.json({error:"Failed to fetch user credits",creditsRemaining:0},{status:500});let a=s.post_generation_credits||0;if(a<1)return o.NextResponse.json({error:"No post generation credits remaining. Please upgrade your plan or purchase more credits.",creditsRemaining:a},{status:402});let{error:u}=await n.from("user_profiles").update({post_generation_credits:a-1,updated_at:new Date().toISOString()}).eq("user_id",t);if(u)return console.error("Credit deduction error:",u),o.NextResponse.json({error:"Failed to deduct credits",creditsRemaining:a},{status:500});r={success:!0,newBalance:a-1},console.log("✅ Credit deduction successful. New balance:",r.newBalance)}let a=process.env.OPENAI_API_KEY;if(!a)return o.NextResponse.json({error:"OpenAI API key not configured"},{status:500});let[p,h]=await Promise.all([m(s,a),g(s,a)]);return o.NextResponse.json({success:!0,result:{caption:p,hashtags:h},creditsRemaining:r.newBalance})}catch(e){return console.error("Video content generation error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e,t){let r=function(e){if(!e)return"Create an engaging social media caption for Instagram that drives engagement and encourages interaction.";let{businessContext:t,platform:r,theme:n,customPrompt:s,tone:i,targetAudience:a,niche:o}=e;return s&&s.includes("IMAGE CONTENT:")?s:`Create an engaging social media caption for ${r||"Instagram"} that:
  
Business Context: ${t}
Content Theme: ${n}
Tone: ${i||"Professional and friendly"}
Target Audience: ${a||"General audience"}
Industry/Niche: ${o||"Business"}

The caption must mention the business name: ${t} and niche: ${o}.

${s?`Additional Context: ${s}`:""}

Requirements:
- Optimized for ${r} platform
- Engaging and authentic tone
- Include relevant emojis
- Encourage interaction
- Keep it concise but impactful
- Match the ${n} theme

Generate a compelling caption that will drive engagement and align with the business context.`}(e);if(!r)throw Error("Failed to create caption prompt");console.log("\uD83D\uDE80 Starting CAPTION generation...");let n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a professional social media content creator specializing in engaging, platform-optimized captions. Create captions that are authentic, engaging, and drive meaningful interactions."},{role:"user",content:r}],max_tokens:300,temperature:.7,presence_penalty:.1,frequency_penalty:.1})});if(!n.ok)throw Error(`OpenAI API error: ${n.status}`);let s=await n.json();return console.log("✅ CAPTION generation complete!"),s.choices[0].message.content.trim()}async function g(e,t){let r=function(e){if(!e)return"Generate relevant hashtags for Instagram social media post that will increase visibility and engagement.";let{businessContext:t,platform:r,theme:n,customPrompt:s,niche:i}=e;return s&&s.includes("PRODUCT:")?s:`Generate relevant hashtags for a ${r||"Instagram"} post about:
  
Business Context: ${t}
Content Theme: ${n}
Industry/Niche: ${i||"Business"}

${s?`Additional Context: ${s}`:""}

Requirements:
- 8-12 relevant hashtags
- Mix of popular and niche hashtags
- Include industry-specific tags
- Optimized for ${r}
- Trending when possible
- No spaces in hashtags

Return only the hashtags separated by spaces, starting with #.`}(e);if(!r)throw Error("Failed to create hashtag prompt");console.log("\uD83D\uDE80 Starting HASHTAGS generation...");let n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a social media hashtag expert. Generate relevant, trending hashtags that will increase post visibility and engagement."},{role:"user",content:r}],max_tokens:200,temperature:.7})});if(!n.ok)throw Error(`OpenAI API error: ${n.status}`);let s=await n.json();return console.log("✅ HASHTAGS generation complete!"),(s.choices[0].message.content.trim().match(/#\w+/g)||[]).map(e=>e.substring(1)).slice(0,12)}let h=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/generate-video-content/route",pathname:"/api/generate-video-content",filename:"route",bundlePath:"app/api/generate-video-content/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/generate-video-content/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:f,workUnitAsyncStorage:_,serverHooks:y}=h;function v(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:_})}},47990:()=>{},49485:(e,t,r)=>{"use strict";r.d(t,{CX:()=>c,X2:()=>a,eM:()=>o});let n=(0,r(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),s=new Map;function i(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}async function a(e){try{if(!i(e))return console.error("❌ Invalid UUID format for admin check:",e),!1;let t=s.get(e);if(t&&Date.now()-t.timestamp<3e5)return console.log("\uD83D\uDD0D Using cached admin check for user:",e,"Result:",t.isAdmin),t.isAdmin;console.log("\uD83D\uDD0D Checking admin access for user:",e);let{data:r,error:a}=await n.rpc("get_user_admin_info",{user_uuid:e});if(a)return console.error("❌ Admin check error:",a),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;if(!r||!Array.isArray(r)||0===r.length)return console.log("ℹ️ No admin info found for user:",e),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let o=r[0];if("boolean"!=typeof o.is_admin||"boolean"!=typeof o.is_active)return console.error("❌ Invalid admin data structure:",o),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1;let c=o.is_admin&&o.is_active;return console.log("✅ Admin check result:",{userId:e,isAdmin:c,role:o.role,isActive:o.is_active}),s.set(e,{isAdmin:c,timestamp:Date.now()}),c}catch(t){return console.error("❌ Error checking admin access:",t),s.set(e,{isAdmin:!1,timestamp:Date.now()}),!1}}async function o(e){return await a(e)}async function c(e){try{if(!i(e))return console.error("❌ Invalid UUID format for admin info check:",e),{isAdmin:!1};let{data:t,error:r}=await n.rpc("get_user_admin_info",{user_uuid:e});if(r||!t||!Array.isArray(t)||0===t.length)return{isAdmin:!1};let s=t[0];if("boolean"!=typeof s.is_admin||"boolean"!=typeof s.is_active)return console.error("❌ Invalid admin data structure:",s),{isAdmin:!1};return{isAdmin:s.is_admin&&s.is_active,role:s.role,permissions:s.permissions}}catch(e){return console.error("Error getting admin info:",e),{isAdmin:!1}}}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68803:(e,t,r)=>{"use strict";function n(e,t={}){let r=[],s=e;return t.required&&(null==e||""===e)?(r.push("This field is required"),{isValid:!1,errors:r}):t.required||null!=e&&""!==e?(s=String(e).trim(),t.sanitize&&(s=s.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"")),t.minLength&&s.length<t.minLength&&r.push(`Minimum length is ${t.minLength} characters`),t.maxLength&&s.length>t.maxLength&&r.push(`Maximum length is ${t.maxLength} characters`),t.pattern&&!t.pattern.test(s)&&r.push("Invalid format"),t.allowedValues&&!t.allowedValues.includes(s)&&r.push(`Must be one of: ${t.allowedValues.join(", ")}`),{isValid:0===r.length,errors:r,sanitizedData:s}):{isValid:!0,errors:[],sanitizedData:""}}function s(e,t={}){let r=[];if(t.required&&!e)return r.push("File is required"),{isValid:!1,errors:r};if(!e)return{isValid:!0,errors:[],sanitizedData:null};if(!(e instanceof File))return r.push("Invalid file object"),{isValid:!1,errors:r};if(t.maxSize&&e.size>t.maxSize){let e=Math.round(t.maxSize/1048576);r.push(`File size must be less than ${e}MB`)}return t.allowedTypes&&!t.allowedTypes.includes(e.type)&&r.push(`File type must be one of: ${t.allowedTypes.join(", ")}`),{isValid:0===r.length,errors:r,sanitizedData:e}}function i(e){return function(e,t){let r=[],n={};if("object"!=typeof e||null===e||Array.isArray(e))return{isValid:!1,errors:["Input must be a valid object"]};for(let[s,i]of Object.entries(t)){let t=i(e[s]);t.isValid?n[s]=t.sanitizedData:r.push(...t.errors.map(e=>`${s}: ${e}`))}return{isValid:0===r.length,errors:r,sanitizedData:n}}(e,{businessContext:e=>n(e,{required:!0,minLength:3,maxLength:500,sanitize:!0}),platform:e=>n(e,{allowedValues:["instagram","facebook","twitter","linkedin","tiktok"]}),theme:e=>n(e,{maxLength:100,sanitize:!0}),tone:e=>n(e,{allowedValues:["professional","casual","friendly","authoritative","playful","inspiring"]}),targetAudience:e=>n(e,{maxLength:200,sanitize:!0}),niche:e=>n(e,{maxLength:100,sanitize:!0})})}r.d(t,{UT:()=>i,nJ:()=>s,oI:()=>n})},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4447,580,6437],()=>r(46429));module.exports=n})();