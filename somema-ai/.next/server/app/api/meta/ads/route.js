(()=>{var e={};e.id=2246,e.ids=[2246],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10325:(e,t,r)=>{"use strict";r.d(t,{o:()=>o});var s=r(77839);class a{constructor(e){this.accessToken=e.accessToken,this.adAccountId=e.adAccountId,s.ZFN.init(this.accessToken)}async getAdAccounts(){try{console.log("Fetching ad accounts...");let e=await fetch(`https://graph.facebook.com/v18.0/me/adaccounts?access_token=${this.accessToken}`),t=await e.json();if(t.error){console.log("Ads API endpoint failed, trying alternative approach:",t.error.message);let e=await fetch(`https://graph.facebook.com/v18.0/me?fields=id,name&access_token=${this.accessToken}`),r=await e.json();if(r.error)throw Error(r.error.message);return console.log("Successfully made Graph API call to /me endpoint"),[]}return t.data||[]}catch(e){throw console.error("Error fetching ad accounts:",e),e}}async getAdAccountDetails(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}?fields=id,name,account_status,currency,timezone_name&access_token=${this.accessToken}`),r=await t.json();if(r.error)throw Error(r.error.message);return r}catch(e){throw console.error("Error fetching ad account details:",e),e}}async getCampaigns(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}/campaigns?fields=id,name,status,objective&access_token=${this.accessToken}`),r=await t.json();if(r.error)throw Error(r.error.message);return r.data||[]}catch(e){throw console.error("Error fetching campaigns:",e),e}}async getAdSets(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}/adsets?fields=id,name,status,campaign_id&access_token=${this.accessToken}`),r=await t.json();if(r.error)throw Error(r.error.message);return r.data||[]}catch(e){throw console.error("Error fetching ad sets:",e),e}}async getAds(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}/ads?fields=id,name,status,adset_id&access_token=${this.accessToken}`),r=await t.json();if(r.error)throw Error(r.error.message);return r.data||[]}catch(e){throw console.error("Error fetching ads:",e),e}}async getAdAccountInsights(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}/insights?fields=impressions,clicks,spend&date_preset=last_30d&access_token=${this.accessToken}`),r=await t.json();if(r.error){console.log("Insights endpoint failed, trying alternative:",r.error.message);let e=await fetch(`https://graph.facebook.com/v18.0/me/accounts?access_token=${this.accessToken}`),t=await e.json();if(t.error)throw Error(t.error.message);return console.log("Successfully made Graph API call to /me/accounts endpoint"),{data:[],summary:{total_count:0}}}return r}catch(e){throw console.error("Error fetching ad account insights:",e),e}}async getCampaignInsights(e){try{let t=await fetch(`https://graph.facebook.com/v18.0/${e}/insights?fields=impressions,clicks,spend&date_preset=last_30d&access_token=${this.accessToken}`),r=await t.json();if(r.error)throw Error(r.error.message);return r}catch(e){throw console.error("Error fetching campaign insights:",e),e}}async validateToken(){try{let e=await fetch(`https://graph.facebook.com/v18.0/me?access_token=${this.accessToken}`),t=await e.json();if(t.error)return{valid:!1,error:t.error.message};return{valid:!0}}catch(e){return{valid:!1,error:e.message}}}}function o(e){return new a(e)}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31614:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>h,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l});var a=r(96559),o=r(48088),c=r(37719),n=r(32190),i=r(66437),u=r(10325);let d=(0,i.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e){try{let t=e.headers.get("authorization");if(!t)return n.NextResponse.json({error:"Authorization header required"},{status:401});let r=t.replace("Bearer ","");console.log("Extracted userId from auth header:",r);let{data:s,error:a}=await d.from("user_profiles").select("meta_credentials").eq("user_id",r).single();if(a)return console.error("Profile query error:",a),n.NextResponse.json({error:`Database error: ${a.message}`},{status:400});if(!s?.meta_credentials||!s?.meta_credentials?.accessToken)return n.NextResponse.json({error:"No Meta credentials found. Please connect your Meta account first."},{status:400});let o=(0,u.o)({accessToken:s.meta_credentials.accessToken}),c=await o.getAdAccounts(),i=null;try{i=c.length>0?await o.getAdAccountInsights(c[0].id):await o.getAdAccountInsights("dummy")}catch(e){console.log("Could not fetch insights (this is normal for new accounts):",e.message)}let l=[];try{c.length>0&&(l=await o.getCampaigns(c[0].id))}catch(e){console.log("Could not fetch campaigns (this is normal for new accounts):",e.message)}return n.NextResponse.json({success:!0,adAccounts:c,insights:i,campaigns:l,message:c.length>0?"Ads API calls completed successfully with ad accounts found":"Ads API calls completed successfully (no ad accounts found, but API calls were made)"})}catch(e){return console.error("Ads API error:",e),n.NextResponse.json({error:e.message||"Failed to fetch ads data"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/meta/ads/route",pathname:"/api/meta/ads",filename:"route",bundlePath:"app/api/meta/ads/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/meta/ads/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:g,serverHooks:m}=h;function f(){return(0,c.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:g})}},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6437,139,7839],()=>r(31614));module.exports=s})();