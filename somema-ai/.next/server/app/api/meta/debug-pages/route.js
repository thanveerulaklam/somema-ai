"use strict";(()=>{var e={};e.id=458,e.ids=[458],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{e.exports=require("punycode")},12412:e=>{e.exports=require("assert")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52817:(e,s,t)=>{t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>_});var a={};t.r(a),t.d(a,{GET:()=>d});var o=t(96559),r=t(48088),n=t(37719),c=t(32190),u=t(66437),i=t(33900);let g=(0,u.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e){let{data:s,error:t}=await g.from("user_profiles").select("meta_credentials").eq("user_id",e).single();return t||!s?.meta_credentials?null:s.meta_credentials}async function d(e){try{let s=e.headers.get("authorization");if(!s)return c.NextResponse.json({error:"Authorization header required"},{status:401});let t=s.replace("Bearer ",""),a=await l(t);if(!a?.accessToken)return c.NextResponse.json({error:"Meta account not connected"},{status:404});console.log("=== DEBUG PAGES ENDPOINT ==="),console.log("User ID:",t),console.log("Access token:",a.accessToken.substring(0,20)+"...");let o={user_id:t,access_token_preview:a.accessToken.substring(0,20)+"...",stored_pages_count:a.pages?.length||0,connected_accounts_count:a.connected?.length||0,methods:{}};console.log("Method 1: Direct /me/accounts call...");try{let e=await fetch(`https://graph.facebook.com/v18.0/me/accounts?fields=id,name,category,category_list,tasks,access_token&access_token=${a.accessToken}&limit=100`),s=await e.json();o.methods.direct_me_accounts={success:!s.error,error:s.error?.message||null,pages_count:s.data?.length||0,pages:s.data||[],paging:s.paging||null},console.log(`✅ Method 1: ${s.data?.length||0} pages found`)}catch(e){o.methods.direct_me_accounts={success:!1,error:e.message,pages_count:0,pages:[],paging:null},console.error("❌ Method 1 failed:",e.message)}console.log("Method 2: Business Manager pages...");try{let e=await fetch(`https://graph.facebook.com/v18.0/me/businesses?fields=id,name&access_token=${a.accessToken}`),s=await e.json();if(o.methods.business_manager={success:!s.error,error:s.error?.message||null,businesses_count:s.data?.length||0,businesses:s.data||[],business_pages:[]},!s.error&&s.data&&s.data.length>0)for(let e of s.data){let s=await fetch(`https://graph.facebook.com/v18.0/${e.id}/owned_pages?fields=id,name,category,category_list,tasks,access_token&access_token=${a.accessToken}&limit=100`),t=await s.json();o.methods.business_manager.business_pages.push({business_id:e.id,business_name:e.name,pages_count:t.data?.length||0,pages:t.data||[],error:t.error?.message||null})}console.log(`✅ Method 2: ${s.data?.length||0} businesses found`)}catch(e){o.methods.business_manager={success:!1,error:e.message,businesses_count:0,businesses:[],business_pages:[]},console.error("❌ Method 2 failed:",e.message)}console.log("Method 3: User info with accounts edge...");try{let e=await fetch(`https://graph.facebook.com/v18.0/me?fields=id,name,accounts{id,name,category,category_list,tasks,access_token}&access_token=${a.accessToken}`),s=await e.json();o.methods.user_accounts_edge={success:!s.error,error:s.error?.message||null,user_info:{id:s.id,name:s.name},accounts_count:s.accounts?.data?.length||0,accounts:s.accounts?.data||[],accounts_paging:s.accounts?.paging||null},console.log(`✅ Method 3: ${s.accounts?.data?.length||0} accounts found`)}catch(e){o.methods.user_accounts_edge={success:!1,error:e.message,user_info:null,accounts_count:0,accounts:[],accounts_paging:null},console.error("❌ Method 3 failed:",e.message)}console.log("Method 4: Meta API Service...");try{let e=(0,i.b)({accessToken:a.accessToken}),s=await e.getFacebookPages();o.methods.meta_api_service={success:!0,error:null,pages_count:s.length,pages:s},console.log(`✅ Method 4: ${s.length} pages found`)}catch(e){o.methods.meta_api_service={success:!1,error:e.message,pages_count:0,pages:[]},console.error("❌ Method 4 failed:",e.message)}for(let e of(console.log("Testing Instagram discovery..."),o.instagram_test={},o.methods.direct_me_accounts?.pages?.slice(0,3)||[]))try{let s=(0,i.b)({accessToken:a.accessToken}),t=await s.getInstagramAccounts(e.id);o.instagram_test[e.id]={page_name:e.name,page_id:e.id,instagram_accounts_count:t.length,instagram_accounts:t},console.log(`✅ Instagram test for ${e.name}: ${t.length} accounts`)}catch(s){o.instagram_test[e.id]={page_name:e.name,page_id:e.id,error:s.message,instagram_accounts_count:0,instagram_accounts:[]},console.error(`❌ Instagram test failed for ${e.name}:`,s.message)}return console.log("=== DEBUG COMPLETE ==="),c.NextResponse.json({success:!0,debug_info:o,summary:{total_methods:Object.keys(o.methods).length,successful_methods:Object.values(o.methods).filter(e=>e.success).length,total_pages_found:Math.max(o.methods.direct_me_accounts?.pages_count||0,o.methods.meta_api_service?.pages_count||0,o.methods.user_accounts_edge?.accounts_count||0)}})}catch(e){return console.error("Debug pages error:",e),c.NextResponse.json({error:e.message||"Failed to debug pages"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/meta/debug-pages/route",pathname:"/api/meta/debug-pages",filename:"route",bundlePath:"app/api/meta/debug-pages/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/meta/debug-pages/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:_,serverHooks:h}=p;function f(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:_})}},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},83997:e=>{e.exports=require("tty")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[4447,580,6437,139,7839,5759],()=>t(52817));module.exports=a})();