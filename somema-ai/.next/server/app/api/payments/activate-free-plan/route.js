(()=>{var e={};e.id=4760,e.ids=[4760],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8805:(e,t,r)=>{"use strict";function s(e,t){let r=new Date(e);return"monthly"===t?(r.setMonth(r.getMonth()+1),r.getDate()!==e.getDate()&&r.setDate(0)):"yearly"===t&&(r.setFullYear(r.getFullYear()+1),r.getDate()!==e.getDate()&&r.setDate(0)),r.toISOString()}r.d(t,{$A:()=>s})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46960:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>d,serverHooks:()=>f,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>l});var a=r(96559),o=r(48088),n=r(37719),i=r(32190),u=r(66437),p=r(8805);let c=(0,u.UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e){try{console.log("\uD83D\uDD0D Free plan activation started");let{userId:t}=await e.json();if(!t)return i.NextResponse.json({error:"User ID is required"},{status:400});console.log("\uD83D\uDCCB Activating free plan for user:",t);let{error:r}=await c.from("user_profiles").upsert({user_id:t,subscription_plan:"free",subscription_status:"active",subscription_start_date:new Date().toISOString(),subscription_end_date:(0,p.$A)(new Date,"monthly"),post_generation_credits:15,image_enhancement_credits:3,media_storage_limit:50,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(r)return console.error("❌ User free plan update error:",r),i.NextResponse.json({error:"Failed to activate free plan"},{status:500});let{error:s}=await c.from("subscriptions").upsert({user_id:t,plan_id:"free",status:"active",current_start_date:new Date().toISOString(),current_end_date:(0,p.$A)(new Date,"monthly"),amount:0,currency:"USD",billing_cycle:"monthly",updated_at:new Date().toISOString()},{onConflict:"user_id"});return s&&console.error("❌ Free plan subscription record error:",s),console.log("✅ Free plan activated successfully for user:",t),i.NextResponse.json({success:!0,message:"Free plan activated successfully"})}catch(e){return console.error("❌ Free plan activation error:",e),i.NextResponse.json({error:"Failed to activate free plan"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/payments/activate-free-plan/route",pathname:"/api/payments/activate-free-plan",filename:"route",bundlePath:"app/api/payments/activate-free-plan/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/payments/activate-free-plan/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:f}=d;function g(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6437],()=>r(46960));module.exports=s})();