(()=>{var e={};e.id=4465,e.ids=[4465],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},39389:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>R,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>d});var n=t(96559),s=t(48088),a=t(37719),i=t(32190),l=t(95457),c=t.n(l);let u=(0,t(66437).UU)("https://yfmypikqgegvookjzvyv.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{let r,t;console.log("\uD83D\uDD0D Payment order creation started");let{planId:o,userId:n,billingCycle:s="monthly",currency:a="USD",amount:l,isIndianVisitor:d=!1}=await e.json();if(console.log("\uD83D\uDCCB Request data:",{planId:o,userId:n,billingCycle:s,currency:a,amount:l,isIndianVisitor:d}),!o||!n)return console.error("❌ Missing required fields:",{planId:o,userId:n}),i.NextResponse.json({error:"Missing required fields"},{status:400});let m={free:{name:"Free Plan",monthly:0,yearly:0,monthlyINR:0,yearlyINR:0,monthlyEUR:0,yearlyEUR:0,monthlyGBP:0,yearlyGBP:0,description:"15 post generations, 3 AI image enhancements (cannot be downloaded), 50 images stored"},starter:{name:"Starter Plan",monthly:1200,yearly:12e3,monthlyINR:99900,yearlyINR:999e3,monthlyEUR:1100,yearlyEUR:11e3,monthlyGBP:1e3,yearlyGBP:1e4,description:"100 post generations, 30 AI image enhancements (downloadable), 500 image/video stored"},growth:{name:"Growth Plan",monthly:3e3,yearly:3e4,monthlyINR:249900,yearlyINR:2499e3,monthlyEUR:2800,yearlyEUR:28e3,monthlyGBP:2500,yearlyGBP:25e3,description:"300 post generations, 100 AI image enhancements (downloadable), Unlimited image/video stored"},scale:{name:"Scale Plan",monthly:10800,yearly:108e3,monthlyINR:899900,yearlyINR:8999e3,monthlyEUR:1e4,yearlyEUR:1e5,monthlyGBP:9e3,yearlyGBP:9e4,description:"1000 post generations, 500 AI image enhancements (downloadable), Unlimited image/video stored"}},p={"enhancement-25":{name:"+25 Image Enhancements",amount:1200,amountINR:99900,amountEUR:1100,amountGBP:1e3,description:"Additional 25 AI image enhancements"},"enhancement-100":{name:"+100 Image Enhancements",amount:4e3,amountINR:329900,amountEUR:3700,amountGBP:3300,description:"Additional 100 AI image enhancements"},"enhancement-250":{name:"+250 Image Enhancements",amount:8e3,amountINR:659900,amountEUR:7400,amountGBP:6600,description:"Additional 250 AI image enhancements"}};if(p[o]){let e=p[o];switch(a){case"INR":r=e.amountINR;break;case"EUR":r=e.amountEUR;break;case"GBP":r=e.amountGBP;break;default:r=e.amount}t=e.name,e.description}else{if(!m[o])return i.NextResponse.json({error:"Invalid plan selected"},{status:400});let e=m[o];if("free"===o)return i.NextResponse.json({success:!0,message:"Free plan activated",planId:"free"});switch(a){case"INR":r="monthly"===s?e.monthlyINR:e.yearlyINR;break;case"EUR":r="monthly"===s?e.monthlyEUR:e.yearlyEUR;break;case"GBP":r="monthly"===s?e.monthlyGBP:e.yearlyGBP;break;default:r="monthly"===s?e.monthly:e.yearly}t=e.name,e.description}if(!process.env.RAZORPAY_KEY_ID||!process.env.RAZORPAY_KEY_SECRET)return console.error("❌ Razorpay credentials not configured"),console.error("RAZORPAY_KEY_ID:",process.env.RAZORPAY_KEY_ID?"Set":"Missing"),console.error("RAZORPAY_KEY_SECRET:",process.env.RAZORPAY_KEY_SECRET?"Set":"Missing"),i.NextResponse.json({error:"Payment service not configured"},{status:500});console.log("✅ Razorpay credentials found");let y=new(c())({key_id:process.env.RAZORPAY_KEY_ID,key_secret:process.env.RAZORPAY_KEY_SECRET}),R=0,g=r,h=!d;d?(R=Math.round(.18*r),g=r+R,h=!1,console.log("\uD83C\uDDEE\uD83C\uDDF3 Indian user detected - GST will be applied regardless of currency")):(R=0,g=r,h=!0,console.log("\uD83C\uDF0D International user detected - no GST (export of services)")),console.log("\uD83D\uDCB0 Creating Razorpay order with amount:",r,"currency:",a),console.log("\uD83D\uDCCA Tax calculation:",{baseAmount:r,taxAmount:R,totalAmount:g,isExport:h});let x=await y.orders.create({amount:g,currency:a,receipt:`order_${Date.now()}`,notes:{planId:o,userId:n,planName:t,billingCycle:s,type:p[o]?"topup":"subscription",isExport:h.toString(),baseAmount:r.toString(),taxAmount:R.toString(),totalAmount:g.toString()}});console.log("✅ Razorpay order created:",x.id),console.log("\uD83D\uDCBE Storing order in database...");let{error:E}=await u.from("payment_orders").insert({order_id:x.id,user_id:n,plan_id:o,amount:r,tax_amount:R,total_amount:g,currency:a,status:"created",billing_cycle:s,is_export:h,tax_details:{gst_rate:18*!!d,tax_type:d?"gst":"export",is_export:h,user_location:d?"india":"international"},created_at:new Date().toISOString()});if(E)return console.error("❌ Database error:",E),i.NextResponse.json({error:"Failed to store order"},{status:500});return console.log("✅ Order stored in database successfully"),console.log("\uD83C\uDF89 Payment order creation completed successfully"),i.NextResponse.json({orderId:x.id,amount:r,taxAmount:R,totalAmount:g,currency:a,isExport:h,key:process.env.RAZORPAY_KEY_ID})}catch(e){return console.error("❌ Payment order creation error:",e),console.error("Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),i.NextResponse.json({error:"Failed to create payment order",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/payments/create-order/route",pathname:"/api/payments/create-order",filename:"route",bundlePath:"app/api/payments/create-order/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/payments/create-order/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:y,serverHooks:R}=m;function g(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:y})}},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[4447,580,6437,139,5457],()=>t(39389));module.exports=o})();