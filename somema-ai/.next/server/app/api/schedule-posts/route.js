"use strict";(()=>{var e={};e.id=6295,e.ids=[6295],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{e.exports=require("punycode")},27910:e=>{e.exports=require("stream")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{e.exports=require("tls")},41506:(e,t,r)=>{r.d(t,{ND:()=>n,yh:()=>i});var s=r(34386);let o="https://yfmypikqgegvookjzvyv.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs",n=(0,s.createBrowserClient)(o,a,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"quely-ai-web"}}}),i=async e=>{let t=await e();return(0,s.createServerClient)(o,a,{cookies:{getAll:()=>t.getAll(),setAll(e){try{e.forEach(({name:e,value:r,options:s})=>{t.set(e,r,s)})}catch{}}}})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67226:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>f,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>g});var o=r(96559),a=r(48088),n=r(37719),i=r(32190),p=r(41506),u=r(44999),c=r(28695),l=r(49485);async function d(e,t){let r=await fetch(`${process.env.BASE_URL||"http://localhost:3000"}/api/generate-content`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({type:"caption",request:e})});if(!r.ok){let e=await r.json();if(402===r.status)throw Error(e.error||"No post generation credits remaining. Please upgrade your plan or purchase more credits.");throw Error("Failed to generate caption")}let s=await r.json();return s.result||s.success||""}async function h(e,t){let r=await fetch(`${process.env.BASE_URL||"http://localhost:3000"}/api/generate-content`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({type:"hashtags",request:e})});if(!r.ok){let e=await r.json();if(402===r.status)throw Error(e.error||"No post generation credits remaining. Please upgrade your plan or purchase more credits.");throw Error("Failed to generate hashtags")}return(await r.json()).result||[]}async function g(e){let{images:t,schedule_type:r,selected_days:s,imageDateMap:o,platform:a="instagram",theme:n="product",customPrompt:g}=await e.json();if(!t||!Array.isArray(t)||0===t.length)return i.NextResponse.json({error:"No images provided"},{status:400});let m=e.headers.get("authorization");if(!m||!m.startsWith("Bearer "))return i.NextResponse.json({error:"Authorization header required"},{status:401});let y=m.replace("Bearer ",""),x=await (0,p.yh)(u.UL),{data:f,error:w}=await x.from("user_profiles").select("business_name, industry, brand_tone, target_audience, post_generation_credits").eq("user_id",y).single();if(w||!f)return i.NextResponse.json({error:"User profile not found"},{status:404});let q=await (0,l.eM)(y),v=f?.post_generation_credits||0,j=t.length;if(!q&&v<j)return i.NextResponse.json({error:`Insufficient post generation credits. You need ${j} credits but only have ${v} remaining. Please upgrade your plan or purchase more credits.`,creditsRemaining:v,creditsNeeded:j},{status:402});q&&console.log("\uD83D\uDC51 Admin user - bypassing credit check for post scheduling");let b=[];for(let e=0;e<t.length;e++){let r=t[e],i="",p=[],u=new Date().toISOString(),l=null,y=null,x=null;o&&o[r]?u=o[r]:s&&s[e]&&(u=s[e]);let w={businessContext:f.business_name,platform:a,theme:n,customPrompt:g,tone:f.brand_tone,targetAudience:f.target_audience,niche:f.industry,imageUrl:r};try{x=await (0,c.AC)(r,m),p=((i=(await (0,c.SW)(x,w)).caption).match(/#\w+/g)||[]).map(e=>e.substring(1))}catch(e){try{i=await d(w,m),p=await h(w,m)}catch(e){i="Generated caption",p=[],l=e.message||e.toString(),y=e.message||e.toString(),console.error("Content generation error:",l)}}b.push({media_url:r,caption:i,hashtags:p,scheduledDate:u,imageAnalysis:x,captionError:l,hashtagsError:y})}return i.NextResponse.json({previews:b})}let m=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/schedule-posts/route",pathname:"/api/schedule-posts",filename:"route",bundlePath:"app/api/schedule-posts/route"},resolvedPagePath:"/Users/thanveerulaklam/Desktop/Projects/Somema/somema-ai/app/api/schedule-posts/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:x,serverHooks:f}=m;function w(){return(0,n.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:x})}},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6437,4386,4999,7774],()=>r(67226));module.exports=s})();