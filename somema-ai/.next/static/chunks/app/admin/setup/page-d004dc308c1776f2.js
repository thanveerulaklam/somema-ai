(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6912],{646:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2824:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>j});var t=a(5155),r=a(2115),i=a(3168),l=a(5552),n=a(5695),d=a(3904),c=a(5525),o=a(9946);let m=(0,o.A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var u=a(646),h=a(4861);let x=(0,o.A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),p=(0,o.A)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var g=a(5199);let y=(0,o.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function j(){let[e,s]=(0,r.useState)(null),[a,o]=(0,r.useState)({databaseReady:!1,adminTablesExist:!1,userHasRole:!1,isSuperAdmin:!1,systemSecure:!1}),[j,b]=(0,r.useState)(!0),[N,v]=(0,r.useState)(null),[f,w]=(0,r.useState)(1),[k,A]=(0,r.useState)(""),[S,I]=(0,r.useState)(""),[R,C]=(0,r.useState)("admin"),_=(0,n.useRouter)();(0,r.useEffect)(()=>{M()},[]);let M=async()=>{try{b(!0),v(null);let e=await (0,l.HW)();if(!e)return void _.push("/login");s(e);let{data:a,error:t}=await i.ND.from("admin_roles").select("id").limit(1),{data:r,error:n}=await i.ND.from("admin_invitations").select("id").limit(1),{data:d,error:c}=await i.ND.from("admin_audit_logs").select("id").limit(1),{data:m,error:u}=await i.ND.rpc("get_user_admin_info",{user_uuid:e.id});o({databaseReady:!0,adminTablesExist:!t&&!n&&!c,userHasRole:m&&m.is_admin,isSuperAdmin:m&&m.is_super_admin,systemSecure:m&&m.is_admin})}catch(e){console.error("Setup status check failed:",e),v("Failed to check setup status")}finally{b(!1)}},D=async()=>{try{b(!0),v(null),w(2)}catch(e){console.error("Database setup failed:",e),v("Database setup failed")}finally{b(!1)}},E=async()=>{try{if(b(!0),v(null),!S||!R)return void v("Please fill in all fields");let{data:s,error:a}=await i.ND.from("admin_invitations").insert({email:S,role:R,invited_by:e.id,invitation_token:crypto.randomUUID(),expires_at:new Date(Date.now()+6048e5).toISOString()}).select().single();if(a||!s)return void v("Failed to create invitation");v(null),I(""),alert("Admin invitation sent to ".concat(S))}catch(e){console.error("Invite admin failed:",e),v("Failed to invite admin")}finally{b(!1)}};return j?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.A,{className:"animate-spin h-8 w-8 mx-auto mb-4 text-blue-600"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Checking admin setup..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"py-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Security Setup"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Secure your admin system with role-based access control"})]})})}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 mr-2 text-blue-600"}),"System Security Status"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(m,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("span",{className:"text-gray-700",children:"Database Ready"}),a.databaseReady?(0,t.jsx)(u.A,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(h.A,{className:"h-5 w-5 text-red-600"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(x,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("span",{className:"text-gray-700",children:"Admin Tables"}),a.adminTablesExist?(0,t.jsx)(u.A,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(h.A,{className:"h-5 w-5 text-red-600"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(p,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("span",{className:"text-gray-700",children:"User Has Role"}),a.userHasRole?(0,t.jsx)(u.A,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(h.A,{className:"h-5 w-5 text-red-600"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(g.A,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("span",{className:"text-gray-700",children:"Super Admin"}),a.isSuperAdmin?(0,t.jsx)(u.A,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(h.A,{className:"h-5 w-5 text-red-600"})]})]}),a.systemSecure&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-green-800",children:[(0,t.jsx)(u.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"✅ System is secure and ready!"})]}),(0,t.jsx)("button",{onClick:()=>{_.push("/admin")},className:"mt-3 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:"Go to Admin Dashboard"})]})]}),!a.systemSecure&&(0,t.jsxs)("div",{className:"space-y-6",children:[1===f&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Step 1: Database Setup"}),(0,t.jsx)("div",{className:"mb-4 p-4 bg-yellow-50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(y,{className:"h-6 w-6 text-yellow-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-yellow-800",children:"Database Setup Required"}),(0,t.jsx)("p",{className:"text-yellow-700 mt-1",children:"You need to run the SQL script to create the admin security tables."})]})]})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Instructions:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-gray-700",children:[(0,t.jsxs)("li",{children:["Go to your ",(0,t.jsx)("a",{href:"https://supabase.com/dashboard",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Supabase Dashboard"})]}),(0,t.jsxs)("li",{children:["Navigate to ",(0,t.jsx)("strong",{children:"SQL Editor"})]}),(0,t.jsxs)("li",{children:["Copy and paste the contents of ",(0,t.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded",children:"add-admin-security.sql"})]}),(0,t.jsxs)("li",{children:["Update ",(0,t.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded",children:"YOUR_USER_ID_HERE"})," with your actual user ID"]}),(0,t.jsx)("li",{children:"Run the script"})]})]}),(0,t.jsx)("button",{onClick:D,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"I've Run the Database Setup"})]}),2===f&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Step 2: Create Super Admin"}),(0,t.jsx)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(u.A,{className:"h-6 w-6 text-blue-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-800",children:"Super Admin Already Created!"}),(0,t.jsxs)("p",{className:"text-blue-700 mt-1",children:["The SQL script has already created you as a super admin with user ID:",(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded ml-2",children:null==e?void 0:e.id})]})]})]})}),(0,t.jsx)("button",{onClick:()=>w(3),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:"Continue to Next Step"})]}),3===f&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Step 3: Invite Additional Admins (Optional)"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address:"}),(0,t.jsx)("input",{type:"email",value:S,onChange:e=>I(e.target.value),placeholder:"admin@yourdomain.com",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role:"}),(0,t.jsxs)("select",{value:R,onChange:e=>C(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"super_admin",children:"Super Admin"})]})]})]}),(0,t.jsx)("button",{onClick:E,className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700",children:"Send Admin Invitation"})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mt-8",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 mr-2 text-green-600"}),"Security Features Implemented"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Role-Based Access Control"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• User roles: user, admin, super_admin"}),(0,t.jsx)("li",{children:"• Granular permissions system"}),(0,t.jsx)("li",{children:"• Role expiration dates"}),(0,t.jsx)("li",{children:"• Permission-based feature access"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Security Measures"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• Row Level Security (RLS)"}),(0,t.jsx)("li",{children:"• Admin action audit logging"}),(0,t.jsx)("li",{children:"• Secure invitation system"}),(0,t.jsx)("li",{children:"• Session validation"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Admin Management"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• Only super admins can grant roles"}),(0,t.jsx)("li",{children:"• Users cannot promote themselves"}),(0,t.jsx)("li",{children:"• Admin access can be revoked"}),(0,t.jsx)("li",{children:"• Invitation-based onboarding"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Audit & Monitoring"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• All admin actions logged"}),(0,t.jsx)("li",{children:"• IP address tracking"}),(0,t.jsx)("li",{children:"• User agent logging"}),(0,t.jsx)("li",{children:"• Action history and reports"})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mt-8",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Troubleshooting"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Database Setup Issues"}),(0,t.jsxs)("p",{className:"text-blue-700 text-sm",children:["If you get errors running the SQL script, make sure you have the necessary permissions and that the ",(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"uuid-ossp"})," extension is enabled."]})]}),(0,t.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-yellow-800 mb-2",children:"Permission Issues"}),(0,t.jsx)("p",{className:"text-yellow-700 text-sm",children:"After setup, you may need to refresh your session or logout/login again for the new permissions to take effect."})]}),(0,t.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"Need Help?"}),(0,t.jsxs)("p",{className:"text-green-700 text-sm",children:["Check the ",(0,t.jsx)("code",{className:"bg-green-100 px-1 rounded",children:"ADMIN_SETUP.md"})," file for detailed setup instructions and security best practices."]})]})]})]})]})]})}},3168:(e,s,a)=>{"use strict";a.d(s,{$G:()=>r,ND:()=>t});let t=(0,a(3865).createBrowserClient)("https://yfmypikqgegvookjzvyv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"quely-ai-web"}}}),r=()=>"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs"},3904:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4861:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},5199:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},5525:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},5552:(e,s,a)=>{"use strict";a.d(s,{HW:()=>i});var t=a(3168);async function r(e){var s,a,r;if(console.error("Auth error:",e),(null==(s=e.message)?void 0:s.includes("Invalid Refresh Token"))||(null==(a=e.message)?void 0:a.includes("Refresh Token Not Found"))||(null==(r=e.message)?void 0:r.includes("JWT expired"))){console.log("Refresh token error detected, clearing session..."),await t.ND.auth.signOut(),localStorage.removeItem("supabase.auth.token"),sessionStorage.removeItem("supabase.auth.token"),window.location.href="/login?error=session_expired";return}throw e}async function i(){try{let{data:{user:e},error:s}=await t.ND.auth.getUser();if(s)return await r(s),null;return e}catch(e){return await r(e),null}}},5695:(e,s,a)=>{"use strict";var t=a(8999);a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},9756:(e,s,a)=>{Promise.resolve().then(a.bind(a,2824))},9946:(e,s,a)=>{"use strict";a.d(s,{A:()=>m});var t=a(2115);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,a)=>a?a.toUpperCase():s.toLowerCase()),l=e=>{let s=i(e);return s.charAt(0).toUpperCase()+s.slice(1)},n=function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return s.filter((e,s,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===s).join(" ").trim()},d=e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,t.forwardRef)((e,s)=>{let{color:a="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:m,iconNode:u,...h}=e;return(0,t.createElement)("svg",{ref:s,...c,width:r,height:r,stroke:a,strokeWidth:l?24*Number(i)/Number(r):i,className:n("lucide",o),...!m&&!d(h)&&{"aria-hidden":"true"},...h},[...u.map(e=>{let[s,a]=e;return(0,t.createElement)(s,a)}),...Array.isArray(m)?m:[m]])}),m=(e,s)=>{let a=(0,t.forwardRef)((a,i)=>{let{className:d,...c}=a;return(0,t.createElement)(o,{ref:i,iconNode:s,className:n("lucide-".concat(r(l(e))),"lucide-".concat(e),d),...c})});return a.displayName=l(e),a}}},e=>{var s=s=>e(e.s=s);e.O(0,[3865,8441,1684,7358],()=>s(9756)),_N_E=e.O()}]);