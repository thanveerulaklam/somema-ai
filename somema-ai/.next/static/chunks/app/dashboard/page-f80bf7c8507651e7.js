(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{2516:(e,s,t)=>{"use strict";t.d(s,{default:()=>E});var a=t(5155),r=t(2115),l=t(5695),i=t(3168),n=t(5552),o=t(4912),c=t(8802),d=t(4416),m=t(7213),u=t(9074),h=t(2713),g=t(4616),x=t(3311),f=t(381),p=t(7434),b=t(4186),j=t(646),w=t(2657),v=t(488),N=t(5684),y=t(3717),k=t(5690),_=t(5199),C=t(1976),S=t(6516),A=t(1366),I=t(2525),D=t(5623);function P(){let[e,s]=(0,r.useState)(null),[t,k]=(0,r.useState)(null),[_,C]=(0,r.useState)({totalPosts:0,scheduledPosts:0,publishedPosts:0,draftPosts:0}),[S,A]=(0,r.useState)(!0),[I,D]=(0,r.useState)(null),[P,E]=(0,r.useState)({instagram:!1,facebook:!1}),M=(0,l.useRouter)(),T=(0,l.useSearchParams)(),[$,z]=(0,r.useState)(!1),[R,q]=(0,r.useState)(0),[O,J]=(0,r.useState)(0),L=(0,c.p)();(0,r.useEffect)(()=>{let e=T.get("message");if(e){D(decodeURIComponent(e));let s=new URL(window.location.href);s.searchParams.delete("message"),window.history.replaceState({},"",s.toString())}if("success"===T.get("subscription")){D("\uD83C\uDF89 Subscription activated successfully! Welcome to your new plan.");let e=new URL(window.location.href);e.searchParams.delete("subscription"),window.history.replaceState({},"",e.toString())}(async()=>{console.log("\uD83D\uDD0D Starting getUser function...");try{let l=await (0,n.HW)();if(console.log("\uD83D\uDC64 User auth result:",l?"User found":"No user"),!l){console.log("❌ No user found, redirecting to login"),M.push("/login");return}s(l),console.log("✅ User set:",l.id),console.log("\uD83D\uDCCB Fetching user profile...");let{data:o,error:c}=await i.ND.from("user_profiles").select("*").eq("user_id",l.id).single();if(console.log("\uD83D\uDCCB Profile result:",o?"Profile found":"No profile",c),o){if(k(o),console.log("✅ Profile set:",o.business_name),console.log("\uD83D\uDCCB Full profile data:",o),![o.business_name,o.industry,o.city,o.country].every(e=>e&&"string"==typeof e&&e.trim().length>0)){console.log("⚠️ Required fields missing, redirecting to settings"),M.push("/settings?message="+encodeURIComponent("Please complete your business profile with required information (Business Name, Industry, City, and Country)"));return}}else{console.log("❌ No profile found, redirecting to onboarding"),M.push("/onboarding");return}console.log("\uD83D\uDCCA Loading dashboard stats..."),await W(l.id),console.log("\uD83C\uDFB2 Loading post generation credits and enhancement credits...");let{data:d,error:m}=await i.ND.from("user_profiles").select("post_generation_credits, image_enhancement_credits, subscription_plan").eq("user_id",l.id).single();if(!m&&d){var e,t,a,r;let s=d.subscription_plan||"free",l=X(s);q(null!=(e=d.post_generation_credits)?e:l),J(null!=(t=d.image_enhancement_credits)?t:l),console.log("✅ Post generation credits set:",null!=(a=d.post_generation_credits)?a:l),console.log("✅ Enhancement credits set:",null!=(r=d.image_enhancement_credits)?r:l)}else{console.log("⚠️ No credits found, defaulting to free plan credits");let e=X("free");q(e),J(e)}console.log("\uD83D\uDD17 Checking Meta connection..."),await V(),A(!1),console.log("✅ Dashboard loading complete")}catch(e){console.error("Error getting user:",e);return}})()},[M,T,T.get("refresh")]);let V=async()=>{try{let{data:{user:e}}=await i.ND.auth.getUser();if(!e)return;let s=await fetch("/api/meta/connect",{headers:{Authorization:"Bearer ".concat(e.id)}});if(s.ok){let e=await s.json(),t=e.available||[],a=e.connected||[],r=a.length>0,l="",i=!1,n="";if(r){let e=a[0],s=t.find(s=>s.id===e.pageId);for(let e of(l=(null==s?void 0:s.name)||"",a)){let s=t.find(s=>s.id===e.pageId);if(s&&Array.isArray(s.instagram_accounts)){let t=s.instagram_accounts.find(s=>s.id===e.instagramId);if(t){i=!0,n=t.username||"";break}}}}E({instagram:i,facebook:r,facebookName:l,instagramName:n})}else E({instagram:!1,facebook:!1})}catch(e){E({instagram:!1,facebook:!1})}},W=async e=>{console.log("\uD83D\uDCCA loadDashboardStats called for user:",e);try{console.log("\uD83D\uDDC4️ Fetching posts from database...");let{count:s,error:t}=await i.ND.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",e);console.log("\uD83D\uDCC8 Total posts from DB:",s,"Error:",t);let a=s||0,r=0,l=0,n=0;if(t){console.error("❌ Error fetching posts from database:",t),console.log("\uD83D\uDD04 Falling back to localStorage...");let e=JSON.parse(localStorage.getItem("posts")||"[]");a=e.length,r=e.filter(e=>"scheduled"===e.status).length,l=e.filter(e=>"published"===e.status).length,n=e.filter(e=>"draft"===e.status).length,console.log("\uD83D\uDCCA Stats from localStorage:",{finalTotalPosts:a,finalScheduledPosts:r,finalPublishedPosts:l,finalDraftPosts:n})}else{console.log("\uD83D\uDCCA Fetching detailed stats from database...");let{count:s}=await i.ND.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("status","scheduled"),{count:t}=await i.ND.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("status","published"),{count:a}=await i.ND.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("status","draft");r=s||0,l=t||0,n=a||0,console.log("\uD83D\uDCCA Detailed stats from DB:",{finalScheduledPosts:r,finalPublishedPosts:l,finalDraftPosts:n})}let o={totalPosts:a,scheduledPosts:r,publishedPosts:l,draftPosts:n};console.log("✅ Setting final stats:",o),C(o)}catch(t){console.error("❌ Error in loadDashboardStats:",t),console.log("\uD83D\uDD04 Falling back to localStorage due to error...");let e=JSON.parse(localStorage.getItem("posts")||"[]"),s={totalPosts:e.length,scheduledPosts:e.filter(e=>"scheduled"===e.status).length,publishedPosts:e.filter(e=>"published"===e.status).length,draftPosts:e.filter(e=>"draft"===e.status).length};console.log("\uD83D\uDCCA Fallback stats:",s),C(s)}},X=e=>{switch(e){case"free":default:return 3;case"starter":return 30;case"growth":return 100;case"scale":return 500}};return S?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n  .line-clamp-2 {\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n  \n  .scrollbar-hide {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  \n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n"}}),$&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 px-2 sm:px-0",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-4 sm:p-8 relative animate-fade-in",children:[(0,a.jsx)("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:()=>z(!1),"aria-label":"Close",children:(0,a.jsx)(d.A,{className:"h-6 w-6"})}),(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4 text-gray-900",children:"What do you want to create?"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(o.$,{variant:"primary",size:"lg",className:"w-full justify-start text-base sm:text-lg py-3 sm:py-4",onClick:()=>{L.trackFeatureUsage("Single Post Creation"),L.metaPixelEvents.viewContent({content_name:"Single Post Creation",content_category:"Feature Usage",value:0,currency:"USD"}),L.trackSmartFeatureUsage("single_post_creation"),z(!1),M.push("/ai/generate")},children:[(0,a.jsx)(m.A,{className:"h-5 w-5 mr-2"})," Single Post"]}),(0,a.jsxs)(o.$,{variant:"secondary",size:"lg",className:"w-full justify-start text-base sm:text-lg py-3 sm:py-4",onClick:()=>{L.trackFeatureUsage("Weekly Posts Creation"),z(!1),M.push("/ai/weekly")},children:[(0,a.jsx)(u.A,{className:"h-5 w-5 mr-2"})," Weekly Posts"]}),(0,a.jsxs)(o.$,{variant:"outline",size:"lg",className:"w-full justify-start text-base sm:text-lg py-3 sm:py-4",onClick:()=>{L.trackFeatureUsage("Monthly Posts Creation"),z(!1),M.push("/ai/monthly")},children:[(0,a.jsx)(h.A,{className:"h-5 w-5 mr-2"})," Monthly Posts"]})]})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-6 sm:py-8",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between mb-6 sm:mb-8 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-1",children:["Welcome",t?", ".concat(t.business_name):"","!"]}),(0,a.jsx)("p",{className:"text-gray-600 text-xs sm:text-sm",children:"Your social media command center"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,a.jsxs)(o.$,{onClick:()=>{var s;L.trackFeatureUsage("Create Post Button Clicked"),L.gtmEvent("dashboard_action",{action:"create_post_clicked",page_section:"dashboard_header",user_type:(null==e||null==(s=e.user_metadata)?void 0:s.plan)||"free"}),z(!0)},className:"bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-200 px-4 py-2.5 rounded-lg font-medium",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Create Post"]}),(0,a.jsxs)(o.$,{onClick:()=>{L.trackFeatureUsage("Add Media Navigation"),M.push("/media")},className:"bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-200 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 px-4 py-2.5 rounded-lg font-medium",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Add Media"]}),(0,a.jsxs)(o.$,{onClick:()=>{L.trackFeatureUsage("AI Enhanced Images Navigation"),L.trackGTMFeatureUsage("ai_enhanced_images",{feature_type:"image_enhancement",user_credits:O,navigation_source:"dashboard"}),M.push("/enhanced-images")},className:"bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-200 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 px-4 py-2.5 rounded-lg font-medium",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"AI Enhanced"]}),(0,a.jsxs)(o.$,{onClick:()=>{L.trackFeatureUsage("Content Calendar Navigation"),M.push("/calendar")},className:"bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-200 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 px-4 py-2.5 rounded-lg font-medium",children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Content Calendar"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-2 rounded-lg bg-gradient-to-r from-purple-100 to-blue-100 text-purple-700 font-semibold text-xs sm:text-sm border border-purple-200 shadow-sm",title:"Post generation credits remaining",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-1"}),R," Credits"]}),(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-2 rounded-lg bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 font-semibold text-xs sm:text-sm border border-blue-200 shadow-sm",title:"AI image enhancement credits remaining",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-1"}),O," Enhancements"]}),(0,a.jsxs)(o.$,{onClick:()=>M.push("/settings"),className:"bg-white hover:bg-gray-50 text-gray-600 border-2 border-gray-200 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 px-4 py-2.5 rounded-lg font-medium",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex flex-col items-center cursor-pointer hover:shadow-md transition-shadow",onClick:()=>M.push("/posts"),children:[(0,a.jsx)(p.A,{className:"h-8 w-8 text-blue-600 mb-2"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:_.totalPosts}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"Total Posts"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex flex-col items-center cursor-pointer hover:shadow-md transition-shadow",onClick:()=>M.push("/posts?status=scheduled"),children:[(0,a.jsx)(b.A,{className:"h-8 w-8 text-yellow-600 mb-2"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:_.scheduledPosts}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"Scheduled"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex flex-col items-center cursor-pointer hover:shadow-md transition-shadow",onClick:()=>M.push("/posts?status=published"),children:[(0,a.jsx)(j.A,{className:"h-8 w-8 text-green-600 mb-2"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:_.publishedPosts}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"Published"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex flex-col items-center cursor-pointer hover:shadow-md transition-shadow",onClick:()=>M.push("/posts?status=draft"),children:[(0,a.jsx)(w.A,{className:"h-8 w-8 text-purple-600 mb-2"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:_.draftPosts}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"Drafts"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex items-center gap-6",children:[(0,a.jsx)(v.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Facebook"}),P.facebook?(0,a.jsxs)("span",{className:"text-green-600 flex items-center",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Connected",P.facebookName?": ".concat(P.facebookName):""]}):(0,a.jsxs)("span",{className:"text-red-600 flex items-center",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Not Connected"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 flex items-center gap-6",children:[(0,a.jsx)(N.A,{className:"h-8 w-8 text-pink-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Instagram"}),P.instagram?(0,a.jsxs)("span",{className:"text-green-600 flex items-center",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Connected",P.instagramName?": ".concat(P.instagramName):""]}):(0,a.jsxs)("span",{className:"text-red-600 flex items-center",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Not Connected"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.A,{className:"h-6 w-6 text-indigo-600"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Content Calendar"})]}),(0,a.jsx)(o.$,{size:"sm",variant:"outline",onClick:()=>M.push("/calendar"),children:"View Full"})]}),(0,a.jsx)(F,{userId:null==e?void 0:e.id})]}),_.draftPosts>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(w.A,{className:"h-6 w-6 text-purple-600"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Drafts"})]}),(0,a.jsx)(o.$,{size:"sm",variant:"outline",onClick:()=>M.push("/posts?status=draft"),children:"View All Drafts"})]}),(0,a.jsx)(U,{userId:null==e?void 0:e.id})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"h-5 w-5 text-blue-600"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:"Quick Actions"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(o.$,{variant:"outline",className:"justify-start h-auto p-4",onClick:()=>M.push("/posts/editor"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(y.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Create New Post"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Design and schedule content"})]})]})}),(0,a.jsx)(o.$,{variant:"outline",className:"justify-start h-auto p-4",onClick:()=>M.push("/media"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-5 w-5 text-green-600"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Manage Media"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Upload and organize assets"})]})]})}),(0,a.jsx)(o.$,{variant:"outline",className:"justify-start h-auto p-4",onClick:()=>M.push("/posts"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(p.A,{className:"h-5 w-5 text-purple-600"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"View All Posts"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Manage your content library"})]})]})}),(0,a.jsx)(o.$,{variant:"outline",className:"justify-start h-auto p-4",onClick:()=>M.push("/enhanced-images"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(x.A,{className:"h-5 w-5 text-pink-600"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"AI Enhanced Images"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"View enhanced images"})]})]})})]})]})]})]})}function E(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(P,{})})}function F(e){let{userId:s}=e,[t,l]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)([]);(0,r.useEffect)(()=>{m((()=>{let e=new Date,s=[];for(let t=0;t<7;t++){let a=new Date(e);a.setDate(e.getDate()+t),s.push(a)}return s})())},[]),(0,r.useEffect)(()=>{let e=async()=>{if(s)try{c(!0);let e=d[0],t=new Date(d[6]);t.setHours(23,59,59,999),console.log("\uD83D\uDD0D Fetching scheduled posts for week:",{userId:s,startOfWeek:e.toISOString(),endOfWeek:t.toISOString()});let{data:a,error:r}=await i.ND.from("posts").select("*").eq("user_id",s).eq("status","scheduled").gte("scheduled_for",e.toISOString()).lte("scheduled_for",t.toISOString()).order("scheduled_for",{ascending:!0});if(r)console.error("❌ Error fetching posts:",r),l([]);else{console.log("✅ Posts fetched successfully:",a);let e=(null==a?void 0:a.filter(e=>e.media_url&&e.media_url.match(/\.(mp4|mov|webm|avi|mkv)$/i)))||[];console.log("\uD83C\uDFA5 Video posts found:",e.length),e.forEach((e,s)=>{var t;console.log("\uD83C\uDFA5 Video post ".concat(s+1,":"),{id:e.id,media_url:e.media_url,isVideo:null!==e.media_url.match(/\.(mp4|mov|webm|avi|mkv)$/i),caption:null==(t=e.caption)?void 0:t.slice(0,30)})}),l(a||[])}}catch(e){console.error("❌ Error fetching posts:",e),l([])}finally{c(!1)}};s&&d.length>0&&e()},[s,d]);let h=e=>{if(!d[e])return[];let s=new Date(d[e]);s.setHours(0,0,0,0);let a=new Date(d[e]);return a.setHours(23,59,59,999),t.filter(e=>{let t=new Date(e.scheduled_for);return t>=s&&t<=a})},g=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),x=e=>e.toLocaleDateString("en-US",{weekday:"long"}),f=e=>e.getDate().toString().padStart(2,"0"),p=e=>{let s=new Date;return e.toDateString()===s.toDateString()};return n?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsxs)("div",{className:"text-gray-500 mb-4",children:[(0,a.jsx)(u.A,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),(0,a.jsx)("p",{className:"text-sm",children:"No posts scheduled for this week"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Create your first post to see it here"})]}),(0,a.jsx)(o.$,{size:"sm",variant:"outline",onClick:()=>window.location.href="/posts/editor",children:"Create Your First Post"})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"space-y-2",children:d.map((e,s)=>{let t=h(s),r=p(e);return(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-24 flex-shrink-0",children:(0,a.jsxs)("div",{className:"text-sm font-medium px-3 py-2 rounded ".concat(r?"bg-yellow-100 text-yellow-800":"text-gray-600"),children:[x(e)," - ",f(e)]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:t.length>0?(0,a.jsx)("div",{className:"flex flex-nowrap gap-2 overflow-x-auto scrollbar-hide pb-2",children:t.map((e,s)=>{var t;return(0,a.jsx)("div",{className:"flex-shrink-0 w-64",children:(0,a.jsx)(M,{post:{id:e.id,platform:e.platform||"multi",userIcon:e.user_avatar||"/api/placeholder/32/32",tags:e.tags?JSON.parse(e.tags):[],headline:(null==(t=e.caption)?void 0:t.slice(0,50))+"...",image:e.media_url||e.thumbnail_url||"/api/placeholder/200/150",isVideo:!!e.media_url&&null!==e.media_url.match(/\.(mp4|mov|webm|avi|mkv)$/i),engagement:"published"===e.status?{likes:e.likes||0,shares:e.shares||0,comments:e.comments||0}:null},time:g(e.scheduled_for)})},s)})}):(0,a.jsx)("div",{className:"text-gray-400 text-xs py-2",children:"No posts scheduled"})})]},s)})})})}function U(e){let{userId:s}=e,[t,l]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=async()=>{if(s)try{c(!0);let{data:e,error:t}=await i.ND.from("posts").select("*").eq("user_id",s).eq("status","draft").order("created_at",{ascending:!1}).limit(3);t?(console.error("❌ Error fetching drafts:",t),l([])):(console.log("✅ Drafts fetched successfully:",e),l(e||[]))}catch(e){console.error("❌ Error fetching drafts:",e),l([])}finally{c(!1)}};s&&e()},[s]),n)?(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"})}):0===t.length?(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No drafts found"})}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>{var s;return(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full",children:"Draft"})]}),(0,a.jsxs)("div",{className:"relative mb-3",children:[e.media_url?(0,a.jsxs)("div",{className:"w-full h-24 rounded-lg overflow-hidden bg-gray-100",children:[e.media_url.match(/\.(mp4|mov|webm|avi|mkv)$/i)?(0,a.jsx)("video",{src:e.media_url,className:"w-full h-full object-cover",muted:!0,preload:"metadata",onError:e=>{var s;e.currentTarget.style.display="none",null==(s=e.currentTarget.nextElementSibling)||s.classList.remove("hidden")}}):(0,a.jsx)("img",{src:e.media_url,alt:"Draft thumbnail",className:"w-full h-full object-cover",onError:e=>{var s;e.currentTarget.style.display="none",null==(s=e.currentTarget.nextElementSibling)||s.classList.remove("hidden")}}),(0,a.jsx)("div",{className:"w-full h-24 bg-gradient-to-br from-purple-200 to-pink-200 rounded-lg flex items-center justify-center hidden",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-purple-400 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-4 w-4 text-white"})})})]}):(0,a.jsx)("div",{className:"w-full h-24 bg-gradient-to-br from-purple-200 to-pink-200 rounded-lg flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-purple-400 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-4 w-4 text-white"})})}),e.media_url&&e.media_url.match(/\.(mp4|mov|webm|avi|mkv)$/i)&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-500 bg-opacity-80 rounded-full flex items-center justify-center",children:(0,a.jsx)(k.A,{className:"h-4 w-4 text-white"})})})]}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-2 line-clamp-2",children:(null==(s=e.caption)?void 0:s.slice(0,60))+"..."}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.$,{size:"sm",variant:"outline",onClick:()=>window.location.href="/posts/editor?postId=".concat(e.id),children:[(0,a.jsx)(y.A,{className:"h-3 w-3 mr-1"}),"Edit"]}),(0,a.jsx)(o.$,{size:"sm",variant:"outline",onClick:()=>window.location.href="/posts?status=draft",children:"View All"})]})]},e.id)})})}function M(e){let{post:s,time:t}=e,r=(0,l.useRouter)(),i=e=>({"Monday morning":"bg-green-100 text-green-800",Promotion:"bg-pink-100 text-pink-800","Citrus madness":"bg-yellow-100 text-yellow-800",Recipes:"bg-gray-100 text-gray-800",Wellbeing:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800";return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm relative cursor-pointer hover:shadow-md hover:border-gray-300 transition-all duration-200",onClick:()=>{r.push("/posts?postId=".concat(s.id))},children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:t}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gray-300 rounded-full border-2 border-white flex items-center justify-center",children:(0,a.jsx)(_.A,{className:"h-3 w-3 text-gray-600"})}),(e=>{switch(e){case"twitter":return(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-400 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"\uD835\uDD4F"})});case"facebook":return(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(v.A,{className:"h-3 w-3 text-white"})});case"instagram":return(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(N.A,{className:"h-3 w-3 text-white"})});default:return(0,a.jsx)("div",{className:"w-6 h-6 bg-gray-400 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"M"})})}})(s.platform)]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:s.tags.map(e=>(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(i(e)),children:e},e))}),(0,a.jsx)("div",{className:"text-xs font-medium text-gray-900 mb-2 line-clamp-2",children:s.headline}),(0,a.jsxs)("div",{className:"relative mb-2",children:[s.image&&"/api/placeholder/200/150"!==s.image?(0,a.jsxs)("div",{className:"w-full h-20 rounded-lg overflow-hidden bg-gray-100",children:[s.isVideo?(0,a.jsx)("video",{src:s.image,className:"w-full h-full object-cover",muted:!0,preload:"metadata",onError:e=>{var s;e.currentTarget.style.display="none",null==(s=e.currentTarget.nextElementSibling)||s.classList.remove("hidden")}}):(0,a.jsx)("img",{src:s.image,alt:"Post thumbnail",className:"w-full h-full object-cover",onError:e=>{var s;e.currentTarget.style.display="none",null==(s=e.currentTarget.nextElementSibling)||s.classList.remove("hidden")}}),(0,a.jsx)("div",{className:"w-full h-20 bg-gradient-to-br from-orange-200 to-pink-200 rounded-lg flex items-center justify-center hidden",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-4 w-4 text-white"})})})]}):(0,a.jsx)("div",{className:"w-full h-20 bg-gradient-to-br from-orange-200 to-pink-200 rounded-lg flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-4 w-4 text-white"})})}),s.isVideo&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-500 bg-opacity-80 rounded-full flex items-center justify-center",children:(0,a.jsx)(k.A,{className:"h-6 w-6 text-white"})})})]}),s.engagement?(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(C.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:s.engagement.likes})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(S.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:s.engagement.shares})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(A.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:s.engagement.comments})]})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(y.A,{className:"h-3 w-3 text-gray-500"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(A.A,{className:"h-3 w-3 text-gray-500"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(I.A,{className:"h-3 w-3 text-gray-500"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(D.A,{className:"h-3 w-3 text-gray-500"})})]})]})}},3168:(e,s,t)=>{"use strict";t.d(s,{$G:()=>r,ND:()=>a});let a=(0,t(3865).createBrowserClient)("https://yfmypikqgegvookjzvyv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"quely-ai-web"}}}),r=()=>"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs"},3999:(e,s,t)=>{"use strict";t.d(s,{cn:()=>l});var a=t(2596),r=t(9688);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}async function i(e){try{console.log("\uD83D\uDD04 Trying fallback HEIC conversion...");let s=await fetch(e),t=await s.blob(),a=document.createElement("canvas"),r=a.getContext("2d");if(!r)throw Error("Canvas context not available");let l=new Image;return new Promise((e,s)=>{l.onload=()=>{try{a.width=l.width,a.height=l.height,r.drawImage(l,0,0);let s=a.toDataURL("image/jpeg",.9);console.log("✅ Fallback HEIC conversion successful"),e(s)}catch(e){console.error("❌ Fallback conversion failed:",e),s(e)}},l.onerror=()=>{console.error("❌ Failed to load image for fallback conversion"),s(Error("Failed to load image"))},l.src=URL.createObjectURL(t)})}catch(e){throw console.error("❌ Fallback HEIC conversion failed:",e),e}}},4912:(e,s,t)=>{"use strict";t.d(s,{$:()=>i});var a=t(5155),r=t(2115),l=t(3999);let i=r.forwardRef((e,s)=>{let{className:t,variant:r="primary",size:i="md",loading:n=!1,children:o,disabled:c,...d}=e;return(0,a.jsxs)("button",{className:(0,l.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-blue-600 text-white hover:bg-blue-700 border border-blue-600",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-200",outline:"border border-gray-300 bg-white text-gray-900 hover:bg-gray-50",ghost:"text-gray-900 hover:bg-gray-100",destructive:"bg-red-600 text-white hover:bg-red-700 border border-red-600"}[r],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-12 px-6 text-lg"}[i],t),ref:s,disabled:c||n,...d,children:[n&&(0,a.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o]})});i.displayName="Button"},5552:(e,s,t)=>{"use strict";t.d(s,{HW:()=>l});var a=t(3168);async function r(e){var s,t,r;if(console.error("Auth error:",e),(null==(s=e.message)?void 0:s.includes("Invalid Refresh Token"))||(null==(t=e.message)?void 0:t.includes("Refresh Token Not Found"))||(null==(r=e.message)?void 0:r.includes("JWT expired"))){console.log("Refresh token error detected, clearing session..."),await a.ND.auth.signOut(),localStorage.removeItem("supabase.auth.token"),sessionStorage.removeItem("supabase.auth.token"),window.location.href="/login?error=session_expired";return}throw e}async function l(){try{let{data:{user:e},error:s}=await a.ND.auth.getUser();if(s)return await r(s),null;return e}catch(e){return await r(e),null}}},6486:(e,s,t)=>{Promise.resolve().then(t.bind(t,2516))}},e=>{var s=s=>e(e.s=s);e.O(0,[3865,4277,5570,8802,8441,1684,7358],()=>s(6486)),_N_E=e.O()}]);