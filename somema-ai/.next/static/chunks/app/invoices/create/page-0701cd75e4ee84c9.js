(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{772:(e,s,i)=>{Promise.resolve().then(i.bind(i,8346))},3168:(e,s,i)=>{"use strict";i.d(s,{$G:()=>t,ND:()=>r});let r=(0,i(3865).createBrowserClient)("https://yfmypikqgegvookjzvyv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"quely-ai-web"}}}),t=()=>"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs"},3999:(e,s,i)=>{"use strict";i.d(s,{cn:()=>a});var r=i(2596),t=i(9688);function a(){for(var e=arguments.length,s=Array(e),i=0;i<e;i++)s[i]=arguments[i];return(0,t.QP)((0,r.$)(s))}async function n(e){try{console.log("\uD83D\uDD04 Trying fallback HEIC conversion...");let s=await fetch(e),i=await s.blob(),r=document.createElement("canvas"),t=r.getContext("2d");if(!t)throw Error("Canvas context not available");let a=new Image;return new Promise((e,s)=>{a.onload=()=>{try{r.width=a.width,r.height=a.height,t.drawImage(a,0,0);let s=r.toDataURL("image/jpeg",.9);console.log("✅ Fallback HEIC conversion successful"),e(s)}catch(e){console.error("❌ Fallback conversion failed:",e),s(e)}},a.onerror=()=>{console.error("❌ Failed to load image for fallback conversion"),s(Error("Failed to load image"))},a.src=URL.createObjectURL(i)})}catch(e){throw console.error("❌ Fallback HEIC conversion failed:",e),e}}},4912:(e,s,i)=>{"use strict";i.d(s,{$:()=>n});var r=i(5155),t=i(2115),a=i(3999);let n=t.forwardRef((e,s)=>{let{className:i,variant:t="primary",size:n="md",loading:l=!1,children:d,disabled:o,...c}=e;return(0,r.jsxs)("button",{className:(0,a.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-blue-600 text-white hover:bg-blue-700 border border-blue-600",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 border border-gray-200",outline:"border border-gray-300 bg-white text-gray-900 hover:bg-gray-50",ghost:"text-gray-900 hover:bg-gray-100",destructive:"bg-red-600 text-white hover:bg-red-700 border border-red-600"}[t],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 py-2",lg:"h-12 px-6 text-lg"}[n],i),ref:s,disabled:o||l,...c,children:[l&&(0,r.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),d]})});n.displayName="Button"},5695:(e,s,i)=>{"use strict";var r=i(8999);i.o(r,"usePathname")&&i.d(s,{usePathname:function(){return r.usePathname}}),i.o(r,"useRouter")&&i.d(s,{useRouter:function(){return r.useRouter}}),i.o(r,"useSearchParams")&&i.d(s,{useSearchParams:function(){return r.useSearchParams}})},6076:(e,s,i)=>{"use strict";i.d(s,{p:()=>n});var r=i(5155),t=i(2115),a=i(3999);let n=t.forwardRef((e,s)=>{let{className:i,type:n,label:l,error:d,helperText:o,id:c,...u}=e,m=(0,t.useId)(),b=c||"input-".concat(m);return(0,r.jsxs)("div",{className:"w-full",children:[l&&(0,r.jsx)("label",{htmlFor:b,className:"block text-sm font-medium text-gray-700 mb-1",children:l}),(0,r.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d&&"border-red-500 focus-visible:ring-red-500",i),ref:s,id:b,...u}),d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d}),o&&!d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o})]})});n.displayName="Input"},8346:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>u});var r=i(5155),t=i(2115),a=i(5695),n=i(3168),l=i(4912),d=i(6076);function o(e){let{planId:s,billingCycle:i,onInvoiceCreated:a,onCancel:n,user:o}=e,[c,u]=(0,t.useState)("individual"),[m,b]=(0,t.useState)({businessName:"",gstNumber:"",businessAddress:{line1:"",line2:"",city:"",state:"",pincode:"",country:"India"},businessType:"proprietorship"}),[h,g]=(0,t.useState)({address:"",address2:"",city:"",state:"",pincode:"",country:"India"}),[x,p]=(0,t.useState)(!1),[y,v]=(0,t.useState)([]);(0,t.useEffect)(()=>{o&&(u(o.customer_type||"individual"),o.business_name&&b(e=>({...e,businessName:o.business_name||"",gstNumber:o.gst_number||""})),o.business_address&&b(e=>({...e,businessAddress:{line1:o.business_address.line1||"",line2:o.business_address.line2||"",city:o.business_address.city||"",state:o.business_address.state||"",pincode:o.business_address.pincode||"",country:o.business_address.country||"India"}})),o.billing_address&&g(e=>({...e,address:o.billing_address.line1||"",address2:o.billing_address.line2||"",city:o.billing_address.city||"",state:o.billing_address.state||"",pincode:o.billing_address.pincode||"",country:o.billing_address.country||"India"})))},[o]);let f=()=>{let e=[];return"business"===c&&(m.businessName.trim()||e.push("Business name is required"),m.gstNumber&&!/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(m.gstNumber.toUpperCase())&&e.push("Invalid GST number format"),m.businessAddress.line1.trim()||e.push("Business address is required"),m.businessAddress.city.trim()||e.push("Business city is required"),m.businessAddress.state.trim()||e.push("Business state is required"),/^\d{6}$/.test(m.businessAddress.pincode)||e.push("Valid 6-digit pincode is required")),h.address.trim()||e.push("Billing address is required"),h.city.trim()||e.push("Billing city is required"),h.state.trim()||e.push("Billing state is required"),/^\d{6}$/.test(h.pincode)||e.push("Valid 6-digit billing pincode is required"),v(e),0===e.length},j=async e=>{if(e.preventDefault(),f()){p(!0),v([]);try{console.log("\uD83D\uDE80 Sending invoice creation request..."),console.log("\uD83D\uDC64 User data:",{id:o.id,email:o.email});let e=await fetch("/api/invoices/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.id,planId:s,billingCycle:i,customerType:c,businessInfo:"business"===c?m:{},billingInfo:h})}),r=await e.json();r.success?a(r.invoice):v([r.error||"Failed to create invoice"])}catch(e){console.error("Error creating invoice:",e),v(["Failed to create invoice. Please try again."])}finally{p(!1)}}},N=(e,s)=>{if(e.includes(".")){let[i,r]=e.split(".");b(e=>({...e,[i]:{...e[i]||{},[r]:s}}))}else b(i=>({...i,[e]:s}))},I=(e,s)=>{g(i=>({...i,[e]:s}))};return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Create Invoice"}),y.length>0&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("ul",{className:"text-red-600 text-sm",children:y.map((e,s)=>(0,r.jsxs)("li",{children:["• ",e]},s))})}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Type"}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",value:"individual",checked:"individual"===c,onChange:e=>u(e.target.value),className:"mr-2"}),"Individual"]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",value:"business",checked:"business"===c,onChange:e=>u(e.target.value),className:"mr-2"}),"Business"]})]})]}),"business"===c&&(0,r.jsxs)("div",{className:"space-y-4 p-4 bg-gray-50 rounded-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Business Information"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name *"}),(0,r.jsx)(d.p,{type:"text",value:m.businessName,onChange:e=>N("businessName",e.target.value),placeholder:"Enter business name",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GST Number"}),(0,r.jsx)(d.p,{type:"text",value:m.gstNumber,onChange:e=>N("gstNumber",e.target.value.toUpperCase()),placeholder:"22AAAAA0000A1Z5",maxLength:15}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 22AAAAA0000A1Z5 (15 characters)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Type"}),(0,r.jsxs)("select",{value:m.businessType,onChange:e=>N("businessType",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"proprietorship",children:"Proprietorship"}),(0,r.jsx)("option",{value:"partnership",children:"Partnership"}),(0,r.jsx)("option",{value:"llp",children:"LLP"}),(0,r.jsx)("option",{value:"private_limited",children:"Private Limited"}),(0,r.jsx)("option",{value:"public_limited",children:"Public Limited"}),(0,r.jsx)("option",{value:"other",children:"Other"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Address Line 1 *"}),(0,r.jsx)(d.p,{type:"text",value:m.businessAddress.line1,onChange:e=>N("businessAddress.line1",e.target.value),placeholder:"Enter business address",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Address Line 2"}),(0,r.jsx)(d.p,{type:"text",value:m.businessAddress.line2,onChange:e=>N("businessAddress.line2",e.target.value),placeholder:"Enter additional address details"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),(0,r.jsx)(d.p,{type:"text",value:m.businessAddress.city,onChange:e=>N("businessAddress.city",e.target.value),placeholder:"Enter city",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),(0,r.jsx)(d.p,{type:"text",value:m.businessAddress.state,onChange:e=>N("businessAddress.state",e.target.value),placeholder:"Enter state",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pincode *"}),(0,r.jsx)(d.p,{type:"text",value:m.businessAddress.pincode,onChange:e=>N("businessAddress.pincode",e.target.value),placeholder:"Enter 6-digit pincode",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]}),(0,r.jsxs)("div",{className:"space-y-4 p-4 bg-gray-50 rounded-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Billing Information"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Address Line 1 *"}),(0,r.jsx)(d.p,{type:"text",value:h.address,onChange:e=>I("address",e.target.value),placeholder:"Enter billing address",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Address Line 2"}),(0,r.jsx)(d.p,{type:"text",value:h.address2,onChange:e=>I("address2",e.target.value),placeholder:"Enter additional address details"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),(0,r.jsx)(d.p,{type:"text",value:h.city,onChange:e=>I("city",e.target.value),placeholder:"Enter city",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),(0,r.jsx)(d.p,{type:"text",value:h.state,onChange:e=>I("state",e.target.value),placeholder:"Enter state",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pincode *"}),(0,r.jsx)(d.p,{type:"text",value:h.pincode,onChange:e=>I("pincode",e.target.value),placeholder:"Enter 6-digit pincode",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(l.$,{type:"button",onClick:n,variant:"outline",disabled:x,children:"Cancel"}),(0,r.jsx)(l.$,{type:"submit",disabled:x,className:"bg-blue-600 hover:bg-blue-700",children:x?"Creating Invoice...":"Create Invoice"})]})]})]})}function c(){let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),[i,l]=(0,t.useState)(null),[d,c]=(0,t.useState)(!0),[u,m]=(0,t.useState)(""),[b,h]=(0,t.useState)("monthly");return((0,t.useEffect)(()=>{let i=s.get("plan"),r=s.get("cycle");i&&m(i),r&&("monthly"===r||"yearly"===r)&&h(r),(async()=>{try{console.log("\uD83D\uDD0D Checking user authentication...");let{data:{user:s},error:i}=await n.ND.auth.getUser(),{data:{session:r},error:t}=await n.ND.auth.getSession();console.log("\uD83D\uDC64 User from getUser:",s?"Found user ".concat(s.id):"No user"),console.log("\uD83D\uDC64 User from session:",(null==r?void 0:r.user)?"Found user ".concat(r.user.id):"No user in session"),console.log("❌ User Error:",i),console.log("❌ Session Error:",t);let a=s||(null==r?void 0:r.user);if(!a){console.log("\uD83D\uDEAA Redirecting to login due to auth error"),e.push("/login");return}let{data:d,error:o}=await n.ND.from("user_profiles").select("*").eq("user_id",a.id).single();if(o&&"PGRST116"===o.code){let{data:e,error:s}=await n.ND.from("user_profiles").insert({user_id:a.id,customer_type:"individual",invoice_email:a.email}).select().single();s?(console.error("Error creating user profile:",s),l(a)):l({...a,...e,id:a.id})}else o?(console.error("Error getting user profile:",o),l(a)):l({...a,...d,id:a.id})}catch(s){console.error("Error getting user:",s),e.push("/login")}finally{c(!1)}})()},[e,s]),d)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,r.jsx)(o,{planId:u,billingCycle:b,onInvoiceCreated:s=>{s.short_url?window.location.href=s.short_url:(alert("Invoice created successfully!"),e.push("/invoices"))},onCancel:()=>{e.push("/pricing")},user:i})})}):null}function u(){return(0,r.jsx)(t.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:(0,r.jsx)(c,{})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[3865,4277,8441,1684,7358],()=>s(772)),_N_E=e.O()}]);