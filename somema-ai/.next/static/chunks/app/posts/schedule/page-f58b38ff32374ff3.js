(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4382],{3168:(e,t,s)=>{"use strict";s.d(t,{$G:()=>l,ND:()=>a});let a=(0,s(3865).createBrowserClient)("https://yfmypikqgegvookjzvyv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"quely-ai-web"}}}),l=()=>"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmbXlwaWtxZ2Vndm9va2p6dnl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTU3NDMsImV4cCI6MjA2NjMzMTc0M30.BX62nqWwNu23pRQYrzoR9EetesEkac3ZdAu2KKXwNxs"},4283:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(5155),l=s(2115),n=s(5695),i=s(3168);function r(){var e;let[t,s]=(0,l.useState)("single"),[r,c]=(0,l.useState)([]),[d,o]=(0,l.useState)([]),[m,u]=(0,l.useState)([]),[h,x]=(0,l.useState)(1),[g,p]=(0,l.useState)(!1),[f,b]=(0,l.useState)(null),y=(0,n.useRouter)(),[w,j]=(0,l.useState)(!1),[N,v]=(0,l.useState)(null),[S,k]=(0,l.useState)(null),[I,_]=(0,l.useState)([]),[D,C]=(0,l.useState)(null),[O,E]=(0,l.useState)({}),[J,M]=(0,l.useState)(null),[P,z]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await i.ND.auth.getUser();if(e&&k(e.id),e){let{data:t}=await i.ND.from("media").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});_(t||[])}})()},[]);let B=e=>{"single"===t?o([e]):"week"===t?null!==D&&E({...O,[D]:e}):"month"===t?J&&z({...P,[J]:e}):d.includes(e)?o(d.filter(t=>t!==e)):d.length<R()&&o([...d,e])},R=()=>"single"===t?1:"week"===t?r.length||7:"month"===t?r.length||30:1;(0,l.useEffect)(()=>{"week"===t&&o(Object.values(O).filter(Boolean))},[O,t]),(0,l.useEffect)(()=>{"month"===t&&o(Object.values(P).filter(Boolean))},[P,t]);let T=(()=>{let e=new Date,t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s,1),l=new Date(t,s+1,0).getDate(),n=a.getDay(),i=[];for(let e=0;e<n;e++)i.push(null);for(let e=1;e<=l;e++){let a=new Date(t,s,e),l=a.toLocaleDateString("en-US",{weekday:"short"});i.push({day:l,date:a.toISOString().slice(0,10)})}for(;i.length%7!=0;)i.push(null);return i})(),X="week"===t?Object.values(O).filter(Boolean).length:"month"===t?Object.values(P).filter(Boolean).length:d.length,U="week"===t?7:"month"===t?T.filter(Boolean).length:R(),A=async()=>{p(!0),b(null);try{let e=d,s=r,a={};"week"===t?(e=[],s=[],Object.entries(O).forEach(t=>{let[l,n]=t;n&&!isNaN(Number(l))&&(e.push(n),s.push(Number(l)),a[n]=Y[Number(l)].date)})):"month"===t&&(e=[],s=[],Object.entries(P).forEach(t=>{let[l,n]=t;n&&(e.push(n),s.push(l),a[n]=l)}));let l={"Content-Type":"application/json"};S&&(l.Authorization="Bearer ".concat(S));let n=await fetch("/api/schedule-posts",{method:"POST",headers:l,body:JSON.stringify({images:e,schedule_type:t,selected_days:s,imageDateMap:a})});if(!n.ok){let e=await n.json();throw Error(e.error||"Failed to generate previews")}let i=await n.json();u(i.previews.map((t,s)=>({...t,media_url:t.media_url||t.image||e[s]}))),x(2)}catch(e){b(e.message||"Unknown error")}finally{p(!1)}},Z=async()=>{j(!0),v(null);try{var e;let t=m.map(e=>({...e,user_id:S,media_url:e.media_url,platform:e.platform||"instagram"})),{data:s}=await i.ND.auth.getSession(),a=null==s||null==(e=s.session)?void 0:e.access_token,l={"Content-Type":"application/json"};a&&(l.Authorization="Bearer ".concat(a));let n=await fetch("/api/save-scheduled-posts",{method:"POST",headers:l,body:JSON.stringify({posts:t})});if(!n.ok){let e=await n.json();throw Error(e.error||"Failed to save scheduled posts")}y.push("/dashboard?message="+encodeURIComponent("Posts scheduled successfully!"))}catch(e){v(e.message||"Unknown error")}finally{j(!1)}},Y=(()=>{let e=new Date,t=[];for(let s=0;s<7;s++){let a=new Date(e);a.setDate(e.getDate()+s);let l=a.toLocaleDateString("en-US",{weekday:"short"});t.push({day:l,date:a.toISOString().slice(0,10)})}return t})();return(()=>{let e=new Date,t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s+1,0),l=[];for(let e=1;e<=a.getDate();e++){let a=new Date(t,s,e),n=a.toLocaleDateString("en-US",{weekday:"short"});l.push({day:n,date:a.toISOString().slice(0,10)})}})(),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Schedule Posts"}),1===h&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"font-semibold",children:"Schedule Type:"}),(0,a.jsxs)("select",{value:t,onChange:e=>{s(e.target.value),c([]),o([]),C(null),E({}),M(null),z({})},className:"ml-2 border rounded px-2 py-1",children:[(0,a.jsx)("option",{value:"single",children:"Single Day"}),(0,a.jsx)("option",{value:"week",children:"Week"}),(0,a.jsx)("option",{value:"month",children:"Month"})]})]}),"week"===t&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"font-semibold",children:"Select Days & Assign Images:"}),(0,a.jsx)("div",{className:"flex gap-4 mt-2",children:Y.map((e,t)=>(0,a.jsxs)("button",{className:"flex flex-col items-center focus:outline-none ".concat(D===t?"ring-2 ring-blue-500 ring-offset-2":""),onClick:()=>C(t),type:"button",children:[(0,a.jsx)("span",{className:"text-xs text-gray-700 mb-1",children:e.day}),(0,a.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 flex items-center justify-center bg-gray-100 overflow-hidden mb-1 ".concat(D===t?"border-blue-500":"border-gray-200"),children:O[t]?(0,a.jsx)("img",{src:O[t],alt:"Selected",className:"object-cover w-full h-full rounded-lg"}):(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:"No Image"})}),(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:e.date})]},e.date))}),(0,a.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"Click a day, then select an image below to assign it."})]}),"month"===t&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"font-semibold",children:"Select Days & Assign Images (Month):"}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2 mt-2",children:T.map((e,t)=>e?(0,a.jsxs)("button",{className:"flex flex-col items-center focus:outline-none ".concat(J===e.date?"ring-2 ring-blue-500 ring-offset-2":""),onClick:()=>M(e.date),type:"button",children:[(0,a.jsx)("span",{className:"text-xs text-gray-700 mb-1",children:e.day}),(0,a.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 flex items-center justify-center bg-gray-100 overflow-hidden mb-1 ".concat(J===e.date?"border-blue-500":"border-gray-200"),children:P[e.date]?(0,a.jsx)("img",{src:P[e.date],alt:"Selected",className:"object-cover w-full h-full rounded-lg"}):(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:"No Image"})}),(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:e.date})]},e.date):(0,a.jsx)("div",{className:"w-24 h-24"},t))}),(0,a.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"Click a day, then select an image below to assign it."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"font-semibold",children:["Select Images","week"===t||"month"===t?" (assign to days)":" (max ".concat(R(),")"),":"]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2 flex-wrap",children:[0===I.length&&(0,a.jsx)("div",{className:"text-gray-500",children:"No images found in your media library."}),I.map((e,s)=>(0,a.jsx)("button",{className:"w-24 h-24 border-2 border-gray-200 rounded overflow-hidden flex items-center justify-center p-0 bg-gray-100 ".concat("week"===t?Object.values(O).includes(e.file_path)?"ring-2 ring-blue-500":"":"month"===t?Object.values(P).includes(e.file_path)?"ring-2 ring-blue-500":"":d.includes(e.file_path)?"ring-2 ring-blue-500":""),onClick:()=>B(e.file_path),disabled:"week"===t?null===D:"month"===t?null===J:"single"!==t&&d.length>=R()&&!d.includes(e.file_path),type:"button",children:e.mime_type&&e.mime_type.startsWith("video/")||e.file_path.match(/\.(mp4|webm|mov)$/i)?(0,a.jsx)("video",{src:e.file_path,className:"object-cover w-full h-full",style:{minWidth:0,minHeight:0}}):(0,a.jsx)("img",{src:e.file_path,alt:e.file_name,className:"object-cover w-full h-full",style:{minWidth:0,minHeight:0},onError:e=>{e.currentTarget.style.display="none"}})},e.id))]}),"week"===t&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Selected day: ",null!==D?null==(e=Y[D])?void 0:e.day:"None"]}),"month"===t&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Selected day: ",J||"None"]}),"week"!==t&&"month"!==t&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Selected: ",d.length]})]}),f&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:f}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",disabled:0===X||g,onClick:A,children:g?"Generating...":"Generate Previews"})]}),2===h&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Preview Scheduled Posts"}),(0,a.jsx)("div",{className:"space-y-8",children:m.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-8 items-start border rounded-lg p-4 bg-white shadow-sm",children:[(0,a.jsxs)("div",{className:"w-full max-w-xs mx-auto md:mx-0",children:[(0,a.jsx)("div",{className:"bg-black rounded-t-lg overflow-hidden aspect-square w-full flex items-center justify-center",children:e.media_url&&e.media_url.match(/\.(mp4|webm|mov)$/i)?(0,a.jsx)("video",{src:e.media_url,controls:!0,className:"object-cover w-full h-full",style:{aspectRatio:"1/1"}}):(0,a.jsx)("img",{src:e.media_url,alt:"Preview",className:"object-cover w-full h-full",style:{aspectRatio:"1/1"}})}),(0,a.jsxs)("div",{className:"bg-white rounded-b-lg border-t px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500 flex items-center justify-center text-white font-bold text-lg",children:"IG"}),(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:"YourBrand"}),(0,a.jsxs)("span",{className:"text-xs text-gray-400 ml-auto",children:["Scheduled: ",new Date(e.scheduledDate).toLocaleString()]})]}),(0,a.jsx)("div",{className:"text-gray-900 whitespace-pre-line",style:{wordBreak:"break-word"},children:e.caption})]})]}),(0,a.jsxs)("div",{className:"flex-1 w-full md:w-1/2",children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Edit Caption"}),(0,a.jsx)("textarea",{className:"border px-3 py-2 rounded w-full min-h-[120px] resize-vertical",value:e.caption,onChange:e=>{let s=[...m];s[t].caption=e.target.value,u(s)}})]})]},t))}),N&&(0,a.jsx)("div",{className:"text-red-600 mt-2",children:N}),(0,a.jsx)("button",{className:"mt-6 bg-green-600 text-white px-6 py-2 rounded disabled:opacity-50",onClick:Z,disabled:w,children:w?"Scheduling...":"Confirm Schedule"})]}),"week"===t&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Scheduled: ",X," / 7 days"]}),"month"===t&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Scheduled: ",X," / ",U," days"]})]})}Array.from({length:31},(e,t)=>t+1)},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},9206:(e,t,s)=>{Promise.resolve().then(s.bind(s,4283))}},e=>{var t=t=>e(e.s=t);e.O(0,[3865,8441,1684,7358],()=>t(9206)),_N_E=e.O()}]);